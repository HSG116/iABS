import React, { useState, useEffect, useRef } from 'react';
import { Settings, Play, Users, Trophy, Clock, Volume2, ChevronLeft, User, Trash2, Sparkles, CheckCircle2, Loader2, Gauge, Zap, Star, LogOut, Home, AlertTriangle, ShieldOff, Brain, Target, MessageSquare, EyeOff, Monitor, BarChart3, Cloud, Hash, Flame, Copy } from 'lucide-react';
import { ChatUser } from '../types';
import { chatService } from '../services/chatService';
import { leaderboardService, supabase } from '../services/supabase';
import { RealtimeChannel } from '@supabase/supabase-js';

interface ForbiddenWordsProps {
    onHome: () => void;
    isOBS?: boolean;
}

interface GameConfig {
    joinKeyword: string;
    maxPlayers: number;
    roundDuration: number;
    autoProgress: boolean;
    totalRounds: number;
}

type GamePhase = 'SETUP' | 'LOBBY' | 'PRE_ROUND' | 'SELECT_WORD' | 'PLAYING' | 'REVEAL' | 'FINALE';

interface ForbiddenChallenge {
    target: string;
    forbidden: string[];
    image?: string;
}

interface GuessStat {
    word: string;
    count: number;
    lastUser: string;
}

const CHALLENGES: ForbiddenChallenge[] = [
    { target: 'مطر', forbidden: ['غيمة', 'شتاء', 'مياه', 'سحاب'] },
    { target: 'كرة قدم', forbidden: ['لاعب', 'هدف', 'ملعب', 'رياضة'] },
    { target: 'قهوة', forbidden: ['كوب', 'بن', 'ساخن', 'صباح'] },
    { target: 'بحر', forbidden: ['سمك', 'موج', 'شاطئ', 'رمل'] },
    { target: 'سيارة', forbidden: ['بنزين', 'طريق', 'عجلات', 'سائق'] },
    { target: 'خبز', forbidden: ['دقيق', 'فرن', 'طعام', 'فطور'] },
    { target: 'طائرة', forbidden: ['مطار', 'سياحة', 'سماء', 'جواز'] },
    { target: 'أسد', forbidden: ['حيوان', 'غابة', 'ملك', 'مفترس'] },
    { target: 'مدرسة', forbidden: ['طالب', 'معلم', 'تعلم', 'حقيبة'] },
    { target: 'هاتف', forbidden: ['اتصال', 'رقم', 'شاشة', 'تطبيقات'] },
    { target: 'شمس', forbidden: ['حرارة', 'نور', 'نهار', 'كواكب'] },
    { target: 'كتاب', forbidden: ['قراءة', 'مكتبة', 'نص', 'مؤلف'] },
    { target: 'سرير', forbidden: ['نوم', 'غرفة', 'راحة', 'وسادة'] },
    { target: 'كرسي', forbidden: ['جلوس', 'خشب', 'طاولة', 'أثاث'] },
    { target: 'طبيب', forbidden: ['مستشفى', 'مرض', 'علاج', 'سماعة'] },
    { target: 'ثلج', forbidden: ['بارد', 'تجمد', 'أبيض', 'شتاء'] },
    { target: 'قلب', forbidden: ['حب', 'دم', 'نبض', 'جسم'] },
    { target: 'قلم', forbidden: ['كتابة', 'ورقة', 'حبر', 'أدوات'] },
    { target: 'قمر', forbidden: ['ليل', 'فضاء', 'نجوم', 'بدأ'] },
    { target: 'شجرة', forbidden: ['غصن', 'أوراق', 'طبيعة', 'غابة'] },
    { target: 'نار', forbidden: ['حريق', 'دخان', 'خشب', 'حرارة'] },
    { target: 'نظارة', forbidden: ['شوف', 'عين', 'قراءة', 'عدسة'] },
    { target: 'سفر', forbidden: ['حقيبة', 'مطار', 'تذكرة', 'فندق'] },
    { target: 'ضحك', forbidden: ['فرح', 'نكتة', 'سعادة', 'وجه'] },
    { target: 'ساعة', forbidden: ['وقت', 'دقائق', 'عقارب', 'معصم'] },
    { target: 'مفتاح', forbidden: ['باب', 'قفل', 'فتح', 'بيت'] },
    { target: 'شوكولاتة', forbidden: ['كاكاو', 'سكر', 'حلويات', 'بني'] },
    { target: 'كاميرا', forbidden: ['صورة', 'فيديو', 'عدسة', 'فلاش'] },
    { target: 'موز', forbidden: ['فاكهة', 'قرد', 'أصفر', 'طويل'] },
    { target: 'بيتزا', forbidden: ['عجينة', 'جبنة', 'مطعم', 'إيطاليا'] },
    { target: 'حاسوب', forbidden: ['شاشة', 'كيبورد', 'برمجة', 'إنترنت'] },
    { target: 'دراجة', forbidden: ['عجل', 'سباق', 'رياضة', 'خوذة'] },
    { target: 'عطر', forbidden: ['ريحة', 'بخاخ', 'زجاجة', 'ورد'] },
    { target: 'عنكبوت', forbidden: ['شبكة', 'خيوط', 'حشرة', 'أرجل'] },
    { target: 'بيانو', forbidden: ['عزف', 'موسيقى', 'أصابع', 'مفاتيح'] },
    { target: 'بركان', forbidden: ['نار', 'حمم', 'جبل', 'انفجار'] },
    { target: 'نحلة', forbidden: ['عسل', 'لسعة', 'صفراء', 'طيران'] },
    { target: 'مظلة', forbidden: ['شمس', 'مطر', 'شتاء', 'فتح'] },
    { target: 'تلفاز', forbidden: ['شاشة', 'مسلسل', 'ريموت', 'أفلام'] },
    { target: 'فواكه', forbidden: ['تفاح', 'موز', 'برتقال', 'فيتامين'] },
    { target: 'مكواة', forbidden: ['حرارة', 'بخار', 'قميص', 'كي'] },
    { target: 'حذاء', forbidden: ['قدم', 'مشي', 'جلد', 'رياضة'] },
    { target: 'محفظة', forbidden: ['فلوس', 'بطاقة', 'جيب', 'مال'] },
    { target: 'مروحة', forbidden: ['هواء', 'صيف', 'حرارة', 'كهرباء'] },
    { target: 'مكيف', forbidden: ['بارد', 'تبريد', 'جهاز', 'صيف'] },
    { target: 'مصباح', forbidden: ['ضوء', 'إنارة', 'كهرباء', 'ليل'] },
    { target: 'أريكة', forbidden: ['جلوس', 'صالة', 'راحة', 'كنبة'] },
    { target: 'سجادة', forbidden: ['أرض', 'فرش', 'صلاة', 'صوف'] },
    { target: 'مرآة', forbidden: ['وجه', 'نظر', 'زجاج', 'انعكاس'] },
    { target: 'سكين', forbidden: ['قطع', 'مطبخ', 'لحم', 'حادة'] },
    { target: 'ملعقة', forbidden: ['أكل', 'شوربة', 'شاي', 'حديد'] },
    { target: 'شوكة', forbidden: ['أكل', 'حديد', 'مطعم', 'مكرونة'] },
    { target: 'ثلاجة', forbidden: ['أكل', 'تبريد', 'مطبخ', 'تجمد'] },
    { target: 'غسالة', forbidden: ['ملابس', 'ماء', 'تنظيف', 'صابون'] },
    { target: 'مكنسة', forbidden: ['تراب', 'أرض', 'تنظيف', 'كنس'] },
    { target: 'فرشاة', forbidden: ['أسنان', 'شعر', 'تنظيف', 'رأس'] },
    { target: 'ورقة', forbidden: ['كتابة', 'شجر', 'أبيض', 'دفتر'] },
    { target: 'تفاح', forbidden: ['أحمر', 'أخضر', 'فاكهة', 'شجر'] },
    { target: 'برتقال', forbidden: ['عصير', 'فاكهة', 'حمضيات', 'لون'] },
    { target: 'بطيخ', forbidden: ['أحمر', 'بذور', 'صيف', 'أخضر'] },
    { target: 'عنب', forbidden: ['أخضر', 'أحمر', 'عنقود', 'زبيب'] },
    { target: 'ليمون', forbidden: ['أصفر', 'حامض', 'عصير', 'شرب'] },
    { target: 'بصل', forbidden: ['دموع', 'طبخ', 'رائحة', 'خضار'] },
    { target: 'ثوم', forbidden: ['رائحة', 'طبخ', 'خضار', 'فص'] },
    { target: 'طماطم', forbidden: ['أحمر', 'سلطة', 'خضار', 'معجون'] },
    { target: 'خيار', forbidden: ['أخضر', 'سلطة', 'خضار', 'ماء'] },
    { target: 'بطاطس', forbidden: ['قلي', 'شيبس', 'خضار', 'أرض'] },
    { target: 'جزر', forbidden: ['أرنب', 'برتقالي', 'نظر', 'خضار'] },
    { target: 'حليب', forbidden: ['أبيض', 'بقرة', 'شرب', 'كالسيوم'] },
    { target: 'بيض', forbidden: ['دجاج', 'فطور', 'مسلوق', 'قلي'] },
    { target: 'عسل', forbidden: ['نحل', 'حلو', 'شفاء', 'سكر'] },
    { target: 'ملح', forbidden: ['طعم', 'أبيض', 'بحر', 'بودرة'] },
    { target: 'فلفل', forbidden: ['حار', 'أخضر', 'أسود', 'بهارات'] },
    { target: 'زيت', forbidden: ['قلي', 'طبخ', 'زيتون', 'سائل'] },
    { target: 'زبدة', forbidden: ['خبز', 'صفراء', 'حليب', 'دهون'] },
    { target: 'جبنة', forbidden: ['حليب', 'فطور', 'بيضاء', 'مالحة'] },
    { target: 'مربى', forbidden: ['فاكهة', 'حلو', 'سكر', 'فراولة'] },
    { target: 'شاي', forbidden: ['كوب', 'أحمر', 'سكر', 'نعناع'] },
    { target: 'آيس كريم', forbidden: ['بارد', 'حلو', 'صيف', 'مثلج'] },
    { target: 'أرز', forbidden: ['أبيض', 'غداء', 'حبة', 'شوربة'] },
    { target: 'مكرونة', forbidden: ['صلصة', 'إيطاليا', 'سباغيتي', 'نشويات'] },
    { target: 'لحم', forbidden: ['خروف', 'بقر', 'بروتين', 'جزار'] },
    { target: 'دجاج', forbidden: ['طائر', 'ريش', 'قلي', 'مشوي'] },
    { target: 'جمبري', forbidden: ['بحر', 'روبيان', 'قشر', 'سمك'] },
    { target: 'عدس', forbidden: ['شوربة', 'أصفر', 'بقوليات', 'شتاء'] },
    { target: 'فستق', forbidden: ['أخضر', 'مكسرات', 'حلويات', 'قشر'] },
    { target: 'زيتون', forbidden: ['شجر', 'أخضر', 'أسود', 'زيت'] },
    { target: 'كاتشب', forbidden: ['طماطم', 'أحمر', 'بطاطس', 'صوص'] },
    { target: 'مايونيز', forbidden: ['بيض', 'أبيض', 'ساندوتش', 'صوص'] },
    { target: 'فراشة', forbidden: ['طيران', 'ألوان', 'جناح', 'حشرة'] },
    { target: 'عزف', forbidden: ['موسيقى', 'آلة', 'بيانو', 'جيتار'] },
    { target: 'نوم', forbidden: ['سرير', 'ليل', 'راحة', 'أحلام'] },
    { target: 'صيف', forbidden: ['حر', 'شاطئ', 'شمس', 'إجازة'] },
    { target: 'شتاء', forbidden: ['مطر', 'برد', 'ثلج', 'غيم'] },
    { target: 'خريف', forbidden: ['شجر', 'أوراق', 'سقوط', 'رياح'] },
    { target: 'ربيع', forbidden: ['ورد', 'أخضر', 'شمس', 'تفتح'] },
    { target: 'مستشفى', forbidden: ['طبيب', 'مرض', 'علاج', 'دواء'] },
    { target: 'صيدلية', forbidden: ['دواء', 'شراء', 'دكتور', 'علاج'] },
    { target: 'حديقة', forbidden: ['عشب', 'ورد', 'أطفال', 'لعب'] },
    { target: 'سينما', forbidden: ['فلم', 'شاشة', 'فشار', 'تذكرة'] },
    { target: 'متحف', forbidden: ['آثار', 'قديم', 'تاريخ', 'تماثيل'] },
    { target: 'مسجد', forbidden: ['صلاة', 'قرآن', 'مسلمين', 'محراب'] },
    { target: 'جامعة', forbidden: ['دراسة', 'كلية', 'شهادة', 'طالب'] },
    { target: 'شركة', forbidden: ['مكتب', 'موظف', 'عمل', 'مدير'] },
    { target: 'بنك', forbidden: ['فلوس', 'حساب', 'بطاقة', 'صراف'] },
    { target: 'سوق', forbidden: ['شراء', 'محلات', 'أغراض', 'فلوس'] },
    { target: 'طريق', forbidden: ['شارع', 'سيارة', 'زحمة', 'سفر'] },
    { target: 'جسر', forbidden: ['نهر', 'عبور', 'فوق', 'بناء'] },
    { target: 'فضاء', forbidden: ['نجوم', 'كواكب', 'أرض', 'مجرة'] },
    { target: 'غابة', forbidden: ['شجر', 'حيوانات', 'خضراء', 'طبيعة'] },
    { target: 'صحراء', forbidden: ['رمل', 'جمال', 'حرارة', 'شمس'] },
    { target: 'جزيرة', forbidden: ['بحر', 'ماء', 'نخل', 'شاطئ'] },
    { target: 'برج', forbidden: ['طويل', 'بناء', 'ناطحة سحاب', 'فندق'] },
    { target: 'طائرة', forbidden: ['طيران', 'سحاب', 'مطار', 'سفر'] },
    { target: 'سفينة', forbidden: ['بحر', 'إبحار', 'باخرة', 'ماء'] },
    { target: 'قطار', forbidden: ['سكة', 'محطة', 'سفر', 'عربات'] },
    { target: 'شاحنة', forbidden: ['كبيرة', 'نقل', 'سيارة', 'طريق'] },
    { target: 'صاروخ', forbidden: ['فضاء', 'سرعة', 'نار', 'انفجار'] },
    { target: 'قبعة', forbidden: ['رأس', 'شمس', 'لبس', 'شعر'] },
    { target: 'سترة', forbidden: ['برد', 'لبس', 'شتاء', 'جاكيت'] },
    { target: 'سماعة', forbidden: ['أذن', 'صوت', 'موسيقى', 'اتصال'] },
    { target: 'ألعاب', forbidden: ['اطفال', 'فيديو', 'تسلية', 'بلايستيشن'] },
    { target: 'رسم', forbidden: ['لوحة', 'ألوان', 'ريشة', 'فنان'] },
    { target: 'كتابة', forbidden: ['قلم', 'دفتر', 'نص', 'مؤلف'] },
    { target: 'سباحة', forbidden: ['بحر', 'مسبح', 'ماء', 'غوص'] },
    { target: 'ركض', forbidden: ['سرعة', 'مشي', 'رياضة', 'تعب'] },
    { target: 'قفز', forbidden: ['عالي', 'أقدام', 'سقوط', 'فوق'] },
    { target: 'رقص', forbidden: ['موسيقى', 'حركة', 'فرح', 'حفلة'] },
    { target: 'طبخ', forbidden: ['أكل', 'مطبخ', 'نار', 'وصفة'] },
    { target: 'قراءة', forbidden: ['كتاب', 'قصة', 'مكتبة', 'معرفة'] },
    { target: 'تدخين', forbidden: ['سيجارة', 'نار', 'رئة', 'ممنوع'] },
    { target: 'عقد', forbidden: ['رقبة', 'ذهب', 'زينة', 'مجوهرات'] },
    { target: 'خاتم', forbidden: ['إصبع', 'ذهب', 'زواج', 'ألماس'] },
    { target: 'محامي', forbidden: ['قانون', 'محكمة', 'قضية', 'دفاع'] },
    { target: 'شرطي', forbidden: ['دورية', 'أمن', 'حرامي', 'سلاح'] },
    { target: 'جندي', forbidden: ['جيش', 'حرب', 'سلاح', 'وطن'] },
    { target: 'طيار', forbidden: ['طائرة', 'سماء', 'سفر', 'قمرة القيادة'] },
    { target: 'مهندس', forbidden: ['بناء', 'خارطة', 'مشروع', 'رسم'] },
    { target: 'صحفي', forbidden: ['أخبار', 'جريدة', 'مقابلة', 'كاميرا'] },
    { target: 'مذيع', forbidden: ['راديو', 'تلفاز', 'صوت', 'برنامج'] },
    { target: 'مطبخ', forbidden: ['طبخ', 'أكل', 'ثلاجة', 'حلل'] },
    { target: 'غرفة', forbidden: ['نوم', 'باب', 'نافذة', 'سرير'] },
    { target: 'ألعاب', forbidden: ['فيديو', 'لعب', 'أطفال', 'بلايستيشن'] },
    { target: 'كرة سلة', forbidden: ['طول', 'ملعب', 'رمي', 'برتقالي'] },
    { target: 'تنس', forbidden: ['مضرب', 'شبكة', 'كرة', 'ملعب'] },
    { target: 'مكتبة', forbidden: ['كتب', 'قراءة', 'استعارة', 'هدوء'] },
    { target: 'حديقة حيوان', forbidden: ['حيوانات', 'أسد', 'فيل', 'قفص'] },
    { target: 'غواصة', forbidden: ['بحر', 'ماء', 'تحت', 'جيش'] },
    { target: 'مظلي', forbidden: ['طائرة', 'قفز', 'هواء', 'باراشوت'] },
    { target: 'خفاش', forbidden: ['ليل', 'طيران', 'كهف', 'أسود'] },
    { target: 'دب', forbidden: ['غابة', 'قوي', 'فراء', 'عسل'] },
    { target: 'بطة', forbidden: ['نهر', 'شباك', 'طائر', 'سباحة'] },
    { target: 'نمر', forbidden: ['خطوط', 'غابة', 'حيوان', 'مفترس'] },
    { target: 'حصان', forbidden: ['سباق', 'ركوب', 'حيوان', 'سريع'] },
    { target: 'حمار وحشي', forbidden: ['خطوط', 'أسود', 'أبيض', 'حيوان'] },
    { target: 'نعامة', forbidden: ['طائر', 'طويلة', 'بيض', 'ركض'] },
    { target: 'بومة', forbidden: ['ليل', 'طيران', 'عين', 'شجر'] },
    { target: 'عصفور', forbidden: ['صغير', 'طيران', 'شجر', 'صوت'] },
    { target: 'تمساح', forbidden: ['ماء', 'مفترس', 'أخضر', 'نهر'] },
    { target: 'سلحفاة', forbidden: ['بطيئة', 'درع', 'بحر', 'بيت'] },
    { target: 'ثعبان', forbidden: ['زحف', 'لسان', 'سام', 'طويل'] },
    { target: 'حلزون', forbidden: ['بطيء', 'قوقعة', 'زحف', 'رطب'] },
    { target: 'نذل', forbidden: ['خيانة', 'سيء', 'كذب', 'علاقة'] },
    { target: 'شجاعة', forbidden: ['قوة', 'قلب', 'جرأة', 'خوف'] },
    { target: 'سعادة', forbidden: ['فرح', 'ضحك', 'ابتسامة', 'شعور'] },
    { target: 'غضب', forbidden: ['عصبية', 'صراخ', 'وجه', 'نار'] },
    { target: 'برد', forbidden: ['شتاء', 'ثلج', 'حرارة', 'ملابس'] },
    { target: 'حر', forbidden: ['صيف', 'شمس', 'مكيف', 'عرق'] },
    { target: 'ليل', forbidden: ['ظلام', 'نوم', 'قمر', 'نجوم'] },
    { target: 'نهار', forbidden: ['شمس', 'ضوء', 'عمل', 'استيقاظ'] },
    { target: 'ماضي', forbidden: ['قديم', 'زمان', 'ذكريات', 'انتهى'] },
    { target: 'مستقبل', forbidden: ['قادم', 'أمل', 'بناء', 'تخطيط'] },
    { target: 'ذكاء', forbidden: ['عقل', 'تفكير', 'دراسة', 'حل'] },
    { target: 'جمال', forbidden: ['شكل', 'وجه', 'حلو', 'بنت'] },
    { target: 'قوة', forbidden: ['عضلات', 'ضرب', 'حديد', 'تحمل'] },
    { target: 'سرعة', forbidden: ['جري', 'وقت', 'سيارة', 'سباق'] },
    { target: 'هدوء', forbidden: ['نوم', 'صمت', 'ليل', 'راحة'] },
    { target: 'ضجيج', forbidden: ['إزعاج', 'صوت', 'شارع', 'صراخ'] },
    { target: 'نظافة', forbidden: ['ماء', 'تنظيف', 'صابون', 'بيت'] },
    { target: 'أناقة', forbidden: ['ملابس', 'شكل', 'جمال', 'حفلة'] },
    { target: 'خاتم زواج', forbidden: ['حب', 'إصبع', 'حفلة', 'ذهب'] },
    { target: 'شهادة', forbidden: ['دراسة', 'جامعة', 'تخرج', 'ورقة'] },
    { target: 'وظيفة', forbidden: ['عمل', 'مدير', 'فلوس', 'شركة'] },
    { target: 'عيد ميلاد', forbidden: ['كيك', 'حفلة', 'هدايا', 'سنة'] },
    { target: 'هدية', forbidden: ['شراء', 'صندوق', 'فرح', 'مناسبة'] },
    { target: 'لغز', forbidden: ['حل', 'تفكير', 'سؤال', 'صعب'] },
    { target: 'نكتة', forbidden: ['ضحك', 'فرح', 'كلام', 'مضحك'] },
    { target: 'سر', forbidden: ['كلام', 'إخفاء', 'أمانة', 'صديق'] },
    { target: 'صوت', forbidden: ['سمع', 'أذن', 'تكلم', 'غناء'] },
    { target: 'رؤية', forbidden: ['نظر', 'عين', 'ضوء', 'شكل'] },
    { target: 'لمس', forbidden: ['يد', 'جلد', 'إحساس', 'قماش'] },
    { target: 'شم', forbidden: ['أنف', 'عطر', 'رائحة', 'ورد'] },
    { target: 'ذوق', forbidden: ['لسان', 'أكل', 'طعم', 'حلو'] },
    { target: 'ذاكرة', forbidden: ['تذكر', 'ماضي', 'دماغ', 'نسيان'] },
    { target: 'صبر', forbidden: ['وقت', 'تحمل', 'انتظار', 'فرج'] },
    { target: 'حب', forbidden: ['قلب', 'شعور', 'زواج', 'رومانسية'] },
    { target: 'صداقة', forbidden: ['صديق', 'وفاء', 'لعب', 'علاقة'] },
    { target: 'رحلة', forbidden: ['سفر', 'بحر', 'جبل', 'طريق'] },
    { target: 'مغامرة', forbidden: ['خطر', 'سفر', 'غابة', 'إثارة'] },
    { target: 'خيال', forbidden: ['تفكير', 'أحلام', 'عقل', 'واقع'] },
    { target: 'واقع', forbidden: ['حياة', 'حقيقة', 'عيش', 'خيال'] },
    { target: 'صوت مرتفع', forbidden: ['إزعاج', 'صراخ', 'مكبر', 'أذن'] },
    { target: 'موسيقى هادئة', forbidden: ['عزف', 'نوم', 'بيانو', 'استرخاء'] },
    { target: 'هواء نقي', forbidden: ['تنفس', 'غابة', 'طبيعة', 'رئة'] },
    { target: 'ماء بارد', forbidden: ['شرب', 'ثلج', 'صيف', 'عطش'] },
    { target: 'قهوة ساخنة', forbidden: ['شرب', 'صباح', 'كوب', 'بن'] },
    { target: 'شوكولاتة بيضاء', forbidden: ['حلو', 'سكر', 'كاكاو', 'بني'] },
    { target: 'سيارة سباق', forbidden: ['سريع', 'طريق', 'عجلات', 'محرك'] },
    { target: 'بيت كبير', forbidden: ['غرف', 'سكن', 'بناء', 'عائلة'] },
    { target: 'شمال', forbidden: ['اتجاه', 'بوصلة', 'جنوب', 'أرض'] },
    { target: 'جنوب', forbidden: ['اتجاه', 'بوصلة', 'شمال', 'أرض'] },
    { target: 'شرق', forbidden: ['اتجاه', 'بوصلة', 'غرب', 'شمس'] },
    { target: 'غرب', forbidden: ['اتجاه', 'بوصلة', 'شرق', 'شمس'] },
    { target: 'فصل الصيف', forbidden: ['حر', 'شمس', 'بحر', 'إجازة'] },
    { target: 'فصل الشتاء', forbidden: ['برد', 'مطر', 'ثلج', 'ملابس'] },
    { target: 'فصل الربيع', forbidden: ['ورد', 'أزهار', 'جو', 'أخضر'] },
    { target: 'فصل الخريف', forbidden: ['شجر', 'أوراق', 'سقوط', 'رياح'] },
    { target: 'يوم الجمعة', forbidden: ['صلاة', 'إجازة', 'نهاية', 'أسبوع'] },
    { target: 'نهاية الأسبوع', forbidden: ['إجازة', 'راحة', 'سفر', 'عمل'] },
    { target: 'العام الجديد', forbidden: ['سنة', 'حفلة', 'وقت', 'احتفال'] },
    { target: 'عيد الفطر', forbidden: ['رمضان', 'صلاة', 'فرح', 'حلويات'] },
    { target: 'عيد الأضحى', forbidden: ['خروف', 'صلاة', 'حج', 'لحم'] },
    { target: 'شهر رمضان', forbidden: ['صوم', 'إفطار', 'قرآن', 'سحور'] },
    { target: 'صلاة الفجر', forbidden: ['ليل', 'نور', 'نوم', 'استيقاظ'] },
    { target: 'القمر الكامل', forbidden: ['ليل', 'نور', 'بدر', 'سماء'] },
    { target: 'النجوم الساطعة', forbidden: ['ليل', 'سماء', 'نور', 'بعيد'] },
    { target: 'البحر الميت', forbidden: ['ملح', 'ماء', 'أردن', 'سباحة'] },
    { target: 'برج إيفل', forbidden: ['باريس', 'فرنسا', 'طويل', 'بناء'] },
    { target: 'الأهرامات', forbidden: ['مصر', 'قديم', 'بناء', 'فراعنة'] },
    { target: 'سور الصين', forbidden: ['عظيم', 'طويل', 'بناء', 'قديم'] },
    { target: 'الكعبة', forbidden: ['مكة', 'صلاة', 'حج', 'مسلمين'] },
    { target: 'المسجد الأقصى', forbidden: ['فلسطين', 'صلاة', 'قديم', 'مسجد'] },
    { target: 'تاج محل', forbidden: ['الهند', 'بناء', 'حب', 'أبيض'] },
    { target: 'نهر النيل', forbidden: ['مصر', 'ماء', 'طويل', 'أفريقيا'] },
    { target: 'جبال الهيمالايا', forbidden: ['قمة', 'عالي', 'ثلج', 'صعود'] },
    { target: 'غابة الأمازون', forbidden: ['شجر', 'حيوانات', 'كبير', 'نهر'] },
    { target: 'المحيط الهادي', forbidden: ['بحر', 'كبير', 'ماء', 'عميق'] },
    { target: 'القطب الشمالي', forbidden: ['برد', 'ثلج', 'دب', 'أبيض'] },
    { target: 'القطب الجنوبي', forbidden: ['برد', 'ثلج', 'بطريق', 'أبيض'] },
    { target: 'كوكب الأرض', forbidden: ['حياة', 'إنسان', 'سيارة', 'ماء'] },
    { target: 'كوكب المريخ', forbidden: ['أحمر', 'فضاء', 'فضاء', 'نجوم'] },
    { target: 'كوكب المشتري', forbidden: ['كبير', 'فضاء', 'نجوم', 'غاز'] },
    { target: 'كوكب زحل', forbidden: ['حلقات', 'فضاء', 'نجوم', 'جميل'] },
    { target: 'الشمس المشرقة', forbidden: ['ضوء', 'حرارة', 'نهار', 'سماء'] },
    { target: 'القمر المنير', forbidden: ['ليل', 'ضوء', 'سماء', 'نجوم'] },
    { target: 'الفضاء الخارجي', forbidden: ['نجوم', 'كواكب', 'بعيد', 'فراغ'] },
    { target: 'الكون الفسيح', forbidden: ['نجوم', 'مجرة', 'كبير', 'خلق'] },
    { target: 'كمبيوتر محمول', forbidden: ['لابتوب', 'جهاز', 'دراسة', 'عمل'] },
    { target: 'سوبر ماركت', forbidden: ['شراء', 'أكل', 'عربة', 'بقالة'] },
    { target: 'صيدلية', forbidden: ['دواء', 'مريض', 'دكتور', 'علاج'] },
    { target: 'محطة قطار', forbidden: ['سفر', 'تذكرة', 'رصيف', 'رحلة'] },
    { target: 'مطار دولي', forbidden: ['طائرة', 'جواز', 'سفر', 'شنطة'] },
    { target: 'فندق 5 نجوم', forbidden: ['غرفة', 'سياحة', 'نوم', 'حجز'] },
    { target: 'مطعم إيطالي', forbidden: ['بيتزا', 'باستا', 'أكل', 'جبنة'] },
    { target: 'مقهى شعبي', forbidden: ['شاي', 'قهوة', 'ناس', 'جلسة'] },
    { target: 'حديقة ملاهي', forbidden: ['لعب', 'أطفال', 'إثارة', 'مدينة'] },
    { target: 'نادي رياضي', forbidden: ['تمرين', 'حديد', 'عضلات', 'جيم'] },
    { target: 'مسرح كبير', forbidden: ['تمثيل', 'عرض', 'جمهور', 'خشبة'] },
    { target: 'سينما', forbidden: ['فيلم', 'فيلم', 'بوب كورن', 'شاشة'] },
    { target: 'مستشفى', forbidden: ['دكتور', 'مريض', 'عملية', 'ممرضة'] },
    { target: 'مدرسة', forbidden: ['تعليم', 'طلاب', 'أستاذ', 'دراسة'] },
    { target: 'جامعة', forbidden: ['كلية', 'تعليم', 'محاضرة', 'تخرج'] },
    { target: 'بنك', forbidden: ['فلوس', 'حساب', 'بطاقة', 'رصيد'] },
    { target: 'مركز شرطة', forbidden: ['أمن', 'بلاغ', 'ضابط', 'سجن'] },
    { target: 'محكمة', forbidden: ['قاضي', 'محامي', 'قانون', 'عدل'] },
    { target: 'بريد', forbidden: ['رسالة', 'صندوق', 'طرد', 'توصيل'] },
    { target: 'مخبز', forbidden: ['خبز', 'كعك', 'طحين', 'فرن'] },
    { target: 'محل ملابس', forbidden: ['شراء', 'قميص', 'بنطلون', 'قياس'] },
    { target: 'صالون حلاقة', forbidden: ['شعر', 'مقص', 'رجل', 'وجه'] },
    { target: 'محل ورد', forbidden: ['أزهار', 'هدية', 'أحمر', 'رائحة'] },
    { target: 'محطة بنزين', forbidden: ['سيارة', 'وقود', 'زيت', 'طريق'] },
    { target: 'ورشة تصليح', forbidden: ['سيارة', 'ميكانيكي', 'عطل', 'أدوات'] },
    { target: 'ملعب كورة', forbidden: ['لاعب', 'مباراة', 'هدف', 'جمهور'] },
    { target: 'مسبح', forbidden: ['ماء', 'سباحة', 'مايوه', 'صيف'] },
    { target: 'شاطئ البحر', forbidden: ['رمل', 'شمس', 'سباحة', 'موج'] },
    { target: 'غابة استوائية', forbidden: ['شجر', 'مطر', 'حيوانات', 'أخضر'] },
    { target: 'صحراء قاحلة', forbidden: ['رمل', 'شمس', 'جمل', 'حرارة'] },
    { target: 'جبل ثلجي', forbidden: ['تسلق', 'برد', 'قمة', 'عالي'] },
    { target: 'وادي', forbidden: ['جبال', 'نهر', 'أرض', 'منخفض'] },
    { target: 'كهف مظلم', forbidden: ['خفاش', 'جبل', 'صخور', 'تحت'] },
    { target: 'بركان ثائر', forbidden: ['حمم', 'نار', 'جبل', 'دخان'] },
    { target: 'زلزال مدمر', forbidden: ['أرض', 'هزة', 'دمار', 'سقوط'] },
    { target: 'فيضان', forbidden: ['ماء', 'مطر', 'بحر', 'دمار'] },
    { target: 'عاصفة رملية', forbidden: ['رمل', 'ريح', 'تراب', 'صحراء'] },
    { target: 'برق ورعد', forbidden: ['مطر', 'سماء', 'ضوء', 'صوت'] },
    { target: 'قوس قزح', forbidden: ['ألوان', 'مطر', 'شمس', 'سماء'] },
    { target: 'كسوف الشمس', forbidden: ['نهار', 'ظلام', 'قمر', 'نظر'] },
    { target: 'خسوف القمر', forbidden: ['ليل', 'أرض', 'ظل', 'نور'] },
    { target: 'مجرة درب التبانة', forbidden: ['فضاء', 'نجوم', 'كون', 'أرض'] },
    { target: 'رائد فضاء', forbidden: ['سفر', 'صاروخ', 'بذلة', 'قمر'] },
    { target: 'مسبار فضائي', forbidden: ['فضاء', 'بحث', 'كوكب', 'تصوير'] },
    { target: 'نجم ساطع', forbidden: ['سماء', 'ليل', 'ضوء', 'بعيد'] },
    { target: 'مذنب', forbidden: ['فضاء', 'ذيل', 'ثلج', 'سماء'] },
    { target: 'منظار نجوم', forbidden: ['تلسكوب', 'نظر', 'فضاء', 'مجرة'] },
    { target: 'ميكروسكوب', forbidden: ['صغير', 'عدسة', 'بحث', 'معمل'] },
    { target: 'روبوت ذكي', forbidden: ['آلة', 'ذكاء', 'إنسان', 'برمجة'] },
    { target: 'كمبيوتر عملاق', forbidden: ['جهاز', 'سرعة', 'بيانات', 'بحث'] },
    { target: 'إنترنت', forbidden: ['شبكة', 'تواصل', 'مواقع', 'عالم'] },
    { target: 'بريد إلكتروني', forbidden: ['رسالة', 'إرسال', 'عنوان', 'حساب'] },
    { target: 'هاتف ذكي', forbidden: ['جوال', 'تطبيق', 'اتصال', 'إنترنت'] },
    { target: 'شاشة بلازما', forbidden: ['تلفزيون', 'فيلم', 'عرض', 'صورة'] },
    { target: 'سماعات لاسلكية', forbidden: ['أذن', 'صوت', 'بلوتوث', 'موسيقى'] },
    { target: 'ساعة ذكية', forbidden: ['يد', 'وقت', 'نبض', 'هاتف'] },
    { target: 'طائرة مسيرة', forbidden: ['درون', 'طيران', 'كاميرا', 'تحكم'] },
    { target: 'نظارة واقع افتراضي', forbidden: ['ألعاب', 'رؤية', 'عالم', 'رأس'] },
    { target: 'سيارة كهربائية', forbidden: ['شحن', 'كهرباء', 'بطارية', 'بيئة'] },
    { target: 'طاقة شمسية', forbidden: ['شمس', 'كهرباء', 'بيئة', 'لوح'] },
    { target: 'إعادة تدوير', forbidden: ['نفايات', 'بيئة', 'بلاستيك', 'ورق'] },
    { target: 'تلوث', forbidden: ['هواء', 'ماء', 'بيئة', 'مصنع'] },
    { target: 'انقراض', forbidden: ['حيوان', 'نادر', 'موت', 'بيئة'] },
    { target: 'ديناصور', forbidden: ['قديم', 'منقرض', 'كبير', 'عظام'] },
    { target: 'متحف التاريخ', forbidden: ['قديم', 'حضارة', 'آثار', 'تماثيل'] },
    { target: 'تمثال الحرية', forbidden: ['أمريكا', 'نيويورك', 'بناء', 'فرنسا'] },
    { target: 'برج بيزا', forbidden: ['إيطاليا', 'مائل', 'بناء', 'سياحة'] },
    { target: 'متحف اللوفر', forbidden: ['فرنسا', 'باريس', 'فن', 'لوحة'] },
    { target: 'قصر بكنغهام', forbidden: ['لندن', 'بريطانيا', 'ملك', 'ملكة'] },
    { target: 'البيت الأبيض', forbidden: ['أمريكا', 'رئيس', 'واشنطن', 'حكم'] },
    { target: 'الكرملين', forbidden: ['روسيا', 'موسكو', 'حكم', 'بناء'] },
    { target: 'مكة المكرمة', forbidden: ['السعودية', 'حج', 'كعبة', 'عمرة'] },
    { target: 'المدينة المنورة', forbidden: ['مسجد', 'نبي', 'السعودية', 'زيارة'] },
    { target: 'القدس الشريف', forbidden: ['فلسطين', 'أقصى', 'قبة', 'صلاة'] },
    { target: 'القاهرة', forbidden: ['مصر', 'نيل', 'أهرامات', 'عاصمة'] },
    { target: 'دبي', forbidden: ['إمارات', 'برج خليفة', 'تسوق', 'سياحة'] },
    { target: 'الرياض', forbidden: ['السعودية', 'عاصمة', 'صحراء', 'بناء'] },
    { target: 'لندن', forbidden: ['بريطانيا', 'ضباب', 'نهر', 'بيغ بن'] },
    { target: 'باريس', forbidden: ['فرنسا', 'عطر', 'برج إيفل', 'حب'] },
    { target: 'نيويورك', forbidden: ['أمريكا', 'تمثال', 'عمل', 'تايمز سكوير'] },
    { target: 'طوكيو', forbidden: ['يابان', 'عاصمة', 'تكنولوجيا', 'ناس'] },
    { target: 'بكين', forbidden: ['صين', 'سور', 'عاصمة', 'ناس'] },
    { target: 'إسطنبول', forbidden: ['تركيا', 'جسر', 'بحر', 'جامع'] },
    { target: 'فيينا', forbidden: ['نمسا', 'موسيقى', 'فن', 'أوروبا'] },
    { target: 'البندقية', forbidden: ['إيطاليا', 'ماء', 'مركب', 'قنال'] },
    { target: 'أثينا', forbidden: ['يونان', 'تاريخ', 'بناء', 'قديم'] },
    { target: 'روما', forbidden: ['إيطاليا', 'كولوسيوم', 'قديم', 'تاريخ'] },
    { target: 'مدريد', forbidden: ['إسبانيا', 'كرة قدم', 'عاصمة', 'أوروبا'] },
    { target: 'برلين', forbidden: ['ألمانيا', 'جدار', 'عاصمة', 'تاريخ'] },
    { target: 'سيدني', forbidden: ['أستراليا', 'أوبرا', 'بحر', 'بعيد'] },
    { target: 'ريو دي جانيرو', forbidden: ['برازيل', 'كرنفال', 'تمثال', 'بحر'] },
    { target: 'سويسرا', forbidden: ['جبال', 'ساعة', 'شوكولاتة', 'بنوك'] },
    { target: 'الهند', forbidden: ['توابل', 'تاج محل', 'أفلام', 'ناس'] },
    { target: 'المغرب', forbidden: ['طاجين', 'صحراء', 'جمال', 'أطلس'] },
    { target: 'تونس', forbidden: ['بحر', 'قرطاج', 'زيتون', 'شمال'] },
    { target: 'الجزائر', forbidden: ['صحراء', 'مساحة', 'جبال', 'أفريقيا'] },
    { target: 'لبنان', forbidden: ['أرز', 'جبال', 'بحر', 'بيروت'] },
    { target: 'الأردن', forbidden: ['بتراء', 'بحر ميت', 'منسف', 'تاريخ'] },
    { target: 'العراق', forbidden: ['نهرين', 'تاريخ', 'بغداد', 'أرض'] },
    { target: 'سوريا', forbidden: ['دمشق', 'قديم', 'تاريخ', 'شام'] },
    { target: 'اليمن', forbidden: ['قديم', 'بناء', 'عرب', 'تاريخ'] },
    { target: 'السودان', forbidden: ['نيل', 'أفريقيا', 'زراعة', 'أرض'] },
    { target: 'الكويت', forbidden: ['بترول', 'أبراج', 'بحر', 'خليج'] },
    { target: 'قطر', forbidden: ['كأس عالم', 'دوحة', 'خليج', 'فلوس'] },
    { target: 'البحرين', forbidden: ['جزيرة', 'جسر', 'خليج', 'سياحة'] },
    { target: 'عمان', forbidden: ['سلطان', 'تاريخ', 'بحر', 'جمال'] },
    { target: 'تركيا', forbidden: ['سياحة', 'أكل', 'بحر', 'تاريخ'] },
    { target: 'إيران', forbidden: ['تار', 'سجاد', 'تاريخ', 'قديم'] },
    { target: 'باكستان', forbidden: ['جبال', 'ناس', 'تاريخ', 'آسيا'] },
    { target: 'أفغانستان', forbidden: ['جبال', 'تاريخ', 'حرارة', 'آسيا'] },
    { target: 'كندا', forbidden: ['برد', 'ثلج', 'شمال', 'مساحة'] },
    { target: 'روسيا', forbidden: ['كبير', 'برد', 'موسكو', 'تاريخ'] },
    { target: 'أمريكا', forbidden: ['واشنطن', 'رئيس', 'دولار', 'قوة'] },
    { target: 'الصين', forbidden: ['ناس', 'صناعة', 'بكين', 'تاريخ'] },
    { target: 'اليابان', forbidden: ['تكنولوجيا', 'طوكيو', 'أنيمي', 'تاريخ'] },
    { target: 'كوريا الجنوبية', forbidden: ['سيول', 'تكنولوجيا', 'أغاني', 'دراما'] },
    { target: 'فيتنام', forbidden: ['غابة', 'تاريخ', 'طبيعة', 'آسيا'] },
    { target: 'إندونيسيا', forbidden: ['جزر', 'بالي', 'استوائي', 'ناس'] },
    { target: 'أستراليا', forbidden: ['كنغر', 'جزيرة', 'بعيد', 'إنجليزي'] },
    { target: 'نيوزيلندا', forbidden: ['طبيعة', 'بعيد', 'أغنام', 'أفلام'] },
    { target: 'جنوب أفريقيا', forbidden: ['نيلسون مانديلا', 'ذهب', 'طبيعة', 'أفريقيا'] },
    { target: 'نيجيريا', forbidden: ['أفريقيا', 'ناس', 'بترول', 'عمل'] },
    { target: 'إثيوبيا', forbidden: ['قهوة', 'أفريقيا', 'تاريخ', 'نيل'] },
    { target: 'كينيا', forbidden: ['سفاري', 'حيوانات', 'أفريقيا', 'جري'] },
    { target: 'الأرجنتين', forbidden: ['ميسي', 'تغو', 'كرة قدم', 'لحم'] },
    { target: 'البرازيل', forbidden: ['كرة قدم', 'سامبا', 'أمازون', 'قهوة'] },
    { target: 'المكسيك', forbidden: ['تاكو', 'تار', 'تاريخ', 'حار'] },
    { target: 'إسبانيا', forbidden: ['برشلونة', 'مدريد', 'لغة', 'تاريخ'] },
    { target: 'إيطاليا', forbidden: ['بيتزا', 'باستا', 'فن', 'تاريخ'] },
    { target: 'فرنسا', forbidden: ['إيفل', 'باريس', 'عطر', 'فن'] },
    { target: 'ألمانيا', forbidden: ['سيارات', 'تكنولوجيا', 'جدار', 'تاريخ'] },
    { target: 'بريطانيا', forbidden: ['لندن', 'ملك', 'لغة', 'تاريخ'] },
    { target: 'هولندا', forbidden: ['طاحونة', 'ورد', 'دراجات', 'أوروبا'] },
    { target: 'بلجيكا', forbidden: ['شوكولاتة', 'بروكسل', 'أوروبا', 'لغة'] },
    { target: 'السويد', forbidden: ['برد', 'إيكيا', 'سلام', 'أوروبا'] },
    { target: 'النرويج', forbidden: ['برد', 'بحر', 'فوسفور', 'شمال'] },
    { target: 'فنلندا', forbidden: ['برد', 'تعليم', 'سانتا', 'أوروبا'] },
    { target: 'الدنمارك', forbidden: ['ليغو', 'أوروبا', 'بحر', 'جزيرة'] },
    { target: 'اليونان', forbidden: ['تاريخ', 'فلسفة', 'جزر', 'أزرق'] },
    { target: 'إيرلندا', forbidden: ['أخضر', 'لغة', 'أوروبا', 'جزيرة'] },
    { target: 'البرتغال', forbidden: ['رونالدو', 'كرة قدم', 'بحر', 'لغة'] },
    { target: 'النمسا', forbidden: ['موسيقا', 'جبال', 'فيينا', 'فن'] },
    { target: 'المجر', forbidden: ['بودابست', 'تاريخ', 'نهر', 'أوروبا'] },
    { target: 'بولندا', forbidden: ['تاريخ', 'أوروبا', 'برد', 'لغة'] },
    { target: 'التشيك', forbidden: ['براغ', 'قديم', 'تاريخ', 'أوروبا'] },
    { target: 'فلسطين', forbidden: ['قدس', 'حرية', 'تاريخ', 'أرض'] },
    { target: 'رغيف خبز', forbidden: ['أكل', 'طحين', 'فرن', 'مخبز'] },
    { target: 'فطيرة تفاح', forbidden: ['حلو', 'فاكهة', 'فرن', 'سكر'] },
    { target: 'عجة بيض', forbidden: ['فطور', 'طبخ', 'مقلاة', 'دجاج'] },
    { target: 'سلطة فواكه', forbidden: ['صحي', 'حلو', 'موز', 'تفاح'] },
    { target: 'عصير برتقال', forbidden: ['شرب', 'صباح', 'حمضيات', 'فيتامين'] },
    { target: 'شاي أخضر', forbidden: ['شرب', 'صحي', 'كوب', 'ساخن'] },
    { target: 'بيتزا مارغريتا', forbidden: ['إيطالي', 'جبنة', 'طماطم', 'فرن'] },
    { target: 'باستا بولو', forbidden: ['دجاج', 'مكرونة', 'أبيض', 'طلياني'] },
    { target: 'كيكة ميلاد', forbidden: ['شمع', 'حفلة', 'حلو', 'سنة'] },
    { target: 'مثلجات فانيليا', forbidden: ['بارد', 'حلو', 'أبيض', 'صيف'] },
    { target: 'بطاطس مهروسة', forbidden: ['أكل', 'خضار', 'طبيخ', 'زبدة'] },
    { target: 'حساء عدس', forbidden: ['شرب', 'شتاء', 'ساخن', 'أصفر'] },
    { target: 'أرز بسمتي', forbidden: ['أبيض', 'طويل', 'طبخ', 'هندي'] },
    { target: 'سمك مشوي', forbidden: ['بحر', 'أكل', 'صحي', 'ليمون'] },
    { target: 'دجاج محمر', forbidden: ['أكل', 'لحم', 'فرن', 'غداء'] },
    { target: 'لحم مشوي', forbidden: ['خروف', 'شواء', 'نار', 'عيد'] },
    { target: 'قهوة اسبريسو', forbidden: ['شرب', 'مركز', 'صغير', 'كافيين'] },
    { target: 'شوكولاتة داكنة', forbidden: ['حلو', 'كاكاو', 'مر', 'صحي'] },
    { target: 'عسل نحل', forbidden: ['حلو', 'نحلة', 'شفاء', 'طبيعي'] },
    { target: 'زيت زيتون', forbidden: ['أكل', 'شجر', 'صحي', 'أخضر'] },
    { target: 'حليب كامل الدسم', forbidden: ['شرب', 'بقرة', 'أبيض', 'كالسيوم'] },
    { target: 'لبن زبادي', forbidden: ['أبيض', 'حليب', 'صحي', 'أكل'] },
    { target: 'بيض مسلوق', forbidden: ['فطور', 'ماء', 'دجاج', 'بروتين'] },
    { target: 'جبنة بيضاء', forbidden: ['أكل', 'فطور', 'حليب', 'ملح'] },
    { target: 'زيتون أخضر', forbidden: ['أكل', 'شجر', 'صغير', 'مخلل'] },
    { target: 'تمور فاخرة', forbidden: ['حلو', 'نخلة', 'رمضان', 'صحراء'] },
    { target: 'مكسرات مشكلة', forbidden: ['تسالي', 'فستق', 'لوز', 'صحي'] },
    { target: 'بشار (فشار)', forbidden: ['ذرة', 'سينما', 'ملح', 'تسالي'] },
    { target: 'علكة (لبان)', forbidden: ['فم', 'مضغ', 'نكهة', 'بالون'] },
    { target: 'بسكويت شاي', forbidden: ['أكل', 'حلو', 'مقرمش', 'كوب'] },
    { target: 'ساندوتش جبنة', forbidden: ['خبز', 'أكل', 'سريع', 'خفيف'] },
    { target: 'كوب شاي', forbidden: ['شرب', 'ساخن', 'نعناع', 'سكر'] },
    { target: 'صحن مكرونة', forbidden: ['أكل', 'طلياني', 'صلصة', 'غداء'] },
    { target: 'قطعة لحم', forbidden: ['أكل', 'خروف', 'بقرة', 'شواء'] },
    { target: 'رأس بصل', forbidden: ['خضار', 'طبخ', 'عين', 'رائحة'] },
    { target: 'فص ثوم', forbidden: ['خضار', 'رائحة', 'طبخ', 'أبيض'] },
    { target: 'حبة خيار', forbidden: ['خضار', 'أخضر', 'سلطة', 'ماء'] },
    { target: 'بندورة حمراء', forbidden: ['خضار', 'طماطم', 'صلصة', 'سلطة'] },
    { target: 'فلفل حار', forbidden: ['خضار', 'أخضر', 'أحمر', 'نار'] },
    { target: 'ليمونة حامضة', forbidden: ['فاكهة', 'أصفر', 'عصير', 'حمضيات'] },
    { target: 'تفاحة خضراء', forbidden: ['فاكهة', 'أكل', 'شجر', 'صحي'] },
    { target: 'موزة صفراء', forbidden: ['فاكهة', 'قرد', 'أكل', 'طويل'] },
    { target: 'عنقود عنب', forbidden: ['فاكهة', 'أخضر', 'أحمر', 'شجر'] },
    { target: 'حبة فراولة', forbidden: ['فاكهة', 'أحمر', 'حلو', 'صغير'] },
    { target: 'بطيخة كبيرة', forbidden: ['فاكهة', 'صيف', 'أخضر', 'أحمر'] },
    { target: 'برتقالة مفيدة', forbidden: ['فاكهة', 'عصير', 'شتاء', 'فيتامين'] },
    { target: 'أناناس غريب', forbidden: ['فاكهة', 'شائك', 'أصفر', 'حلو'] },
    { target: 'رمانة مليئة', forbidden: ['فاكهة', 'أحمر', 'حب', 'حامض'] },
    { target: 'كاميليا زهرة', forbidden: ['ورد', 'جميل', 'رائحة', 'حديقة'] },
    { target: 'ياسمين شامي', forbidden: ['ورد', 'أبيض', 'رائحة', 'سوريا'] },
    { target: 'نخلة عالية', forbidden: ['شجر', 'تمر', 'صحراء', 'طويل'] },
    { target: 'شجرة زيتون', forbidden: ['أخضر', 'زيت', 'فلسطين', 'قديم'] },
    { target: 'صنوبر مفيد', forbidden: ['شجر', 'جبال', 'مكسرات', 'أخضر'] },
    { target: 'غابة بلوط', forbidden: ['شجر', 'خشب', 'أخضر', 'طبيعة'] },
    { target: 'نسيم عليل', forbidden: ['هواء', 'بارد', 'جو', 'جميل'] },
    { target: 'ريح قوية', forbidden: ['هواء', 'عاصفة', 'دوران', 'شديد'] },
    { target: 'مطر غزير', forbidden: ['ماء', 'شتاء', 'سماء', 'سقوط'] },
    { target: 'ثلج أبيض', forbidden: ['بارد', 'شتاء', 'جبل', 'لعب'] },
    { target: 'سحابة عابرة', forbidden: ['سماء', 'مطر', 'أبيض', 'فوق'] },
    { target: 'شمس مشرقة', forbidden: ['نهار', 'ضوء', 'حرارة', 'سماء'] },
    { target: 'قمر منير', forbidden: ['ليل', 'ضوء', 'سماء', 'نجوم'] },
    { target: 'نجمة ساطعة', forbidden: ['سماء', 'ليل', 'ضوء', 'بعيد'] },
    { target: 'بحر واسع', forbidden: ['ماء', 'أزرق', 'رمل', 'سباحة'] },
    { target: 'موج عالي', forbidden: ['بحر', 'ماء', 'حركة', 'شاطئ'] },
    { target: 'نهر جار', forbidden: ['ماء', 'عذب', 'طويل', 'نيل'] },
    { target: 'بحيرة هادئة', forbidden: ['ماء', 'جبال', 'جميل', 'صغير'] },
    { target: 'جزيرة نائية', forbidden: ['بحر', 'ماء', 'شاطئ', 'بعيد'] },
    { target: 'جبل شاهق', forbidden: ['عالي', 'قمة', 'صخور', 'تسلق'] },
    { target: 'تلة خضراء', forbidden: ['أرض', 'عشب', 'جميل', 'مرتفع'] },
    { target: 'وادي عميق', forbidden: ['جبال', 'نهر', 'أرض', 'منخفض'] },
    { target: 'سهل واسع', forbidden: ['أرض', 'زراعة', 'عشب', 'منبسط'] },
    { target: 'تراب الأرض', forbidden: ['زراعة', 'بني', 'غبار', 'ماشي'] },
    { target: 'صخرة صلبة', forbidden: ['جبل', 'قوي', 'تحمل', 'بناء'] },
    { target: 'حديد قوي', forbidden: ['معدن', 'بناء', 'صلب', 'سيارة'] },
    { target: 'ذهب غالي', forbidden: ['معدن', 'أصفر', 'خاتم', 'فلوس'] },
    { target: 'فضة لامعة', forbidden: ['معدن', 'أبيض', 'خاتم', 'زينة'] },
    { target: 'نحاس قديم', forbidden: ['معدن', 'أحمر', 'أسلاك', 'قديم'] },
    { target: 'خشب طبيعي', forbidden: ['شجر', 'طاولة', 'بناء', 'أثاث'] },
    { target: 'بلاستيك مرن', forbidden: ['صناعة', 'بولي', 'علبة', 'بيئة'] },
    { target: 'زجاج شفاف', forbidden: ['نافذة', 'كوب', 'كسر', 'رؤية'] },
    { target: 'ورق ناعم', forbidden: ['كتابة', 'دفتر', 'شجر', 'أبيض'] },
    { target: 'قماش ملون', forbidden: ['خياطة', 'ملابس', 'قطن', 'صوف'] },
    { target: 'قطن ناصع', forbidden: ['أبيض', 'ملابس', 'ناعم', 'نبات'] },
    { target: 'صوف دافئ', forbidden: ['شتاء', 'خروف', 'ملابس', 'خياطة'] },
    { target: 'حرير غالي', forbidden: ['ناعم', 'دودة', 'ملابس', 'جميل'] },
    { target: 'جلد طبيعي', forbidden: ['حيوان', 'حذاء', 'حقيبة', 'جاكيت'] },
    { target: 'مطاط مرن', forbidden: ['عجلات', 'كرة', 'تمدد', 'صناعة'] },
    { target: 'بنزين سريع', forbidden: ['وقود', 'سيارة', 'محطة', 'طاقة'] },
    { target: 'فحم أسود', forbidden: ['نار', 'شواء', 'طاقة', 'قديم'] },
    { target: 'غاز طبيعي', forbidden: ['طبخ', 'طاقة', 'نار', 'منزل'] },
    { target: 'كهرباء منيرة', forbidden: ['ضوء', 'طاقة', 'سلك', 'جهاز'] },
    { target: 'طاقة رياح', forbidden: ['هواء', 'مروحة', 'بيئة', 'كهرباء'] },
    { target: 'مفاعل نووي', forbidden: ['طاقة', 'قوة', 'علم', 'خطر'] },
    { target: 'قنبلة ذرية', forbidden: ['حرب', 'انفجار', 'دمار', 'قوة'] },
    { target: 'بارود قديم', forbidden: ['نار', 'سلاح', 'انفجار', 'حرب'] },
    { target: 'صاروخ فضاء', forbidden: ['قمر', 'سفر', 'نار', 'سرعة'] },
    { target: 'دبابة ثقيلة', forbidden: ['حرب', 'جندي', 'جيش', 'سلاح'] },
    { target: 'طائرة حرب', forbidden: ['سماء', 'طيار', 'حرب', 'جيش'] },
    { target: 'سفينة بحر', forbidden: ['ماء', 'إبحار', 'كبير', 'باخرة'] },
    { target: 'مركب صيد', forbidden: ['بحر', 'سمك', 'ماء', 'خشب'] },
    { target: 'دراجة هوائية', forbidden: ['عجلتين', 'رياضة', 'طريق', 'توازن'] },
    { target: 'سيارة جيب', forbidden: ['كبيرة', 'طريق', 'قوية', 'دفع رباعي'] },
    { target: 'شاحنة نقل', forbidden: ['كبيرة', 'طريق', 'سيارة', 'بضائع'] },
    { target: 'حافلة ركاب', forbidden: ['باص', 'طريق', 'ناس', 'مواصلات'] },
    { target: 'قطار سريع', forbidden: ['سكة', 'محطة', 'نقل', 'سفر'] },
    { target: 'مترو أنفاق', forbidden: ['تحت', 'أرض', 'قطار', 'مدينة'] },
    { target: 'رصيف مشاة', forbidden: ['شارع', 'طريق', 'مشي', 'جانب'] },
    { target: 'إشارة مرور', forbidden: ['شارع', 'أحمر', 'أخضر', 'توقف'] },
    { target: 'شرطي مرور', forbidden: ['شارع', 'مخالفة', 'سيارة', 'تنظيم'] },
    { target: 'رخصة قيادة', forbidden: ['سيارة', 'سواقة', 'بطاقة', 'قانون'] },
    { target: 'جواز سفر', forbidden: ['طار', 'حدود', 'سفر', 'دولة'] },
    { target: 'تذاكر سفر', forbidden: ['طيارة', 'قطار', 'حجز', 'فلوس'] },
    { target: 'حقيبة سفر', forbidden: ['ملابس', 'شنطة', 'سفر', 'مطار'] },
    { target: 'فندق مريح', forbidden: ['سياحة', 'نوم', 'غرفة', 'حجز'] },
    { target: 'متحف آثار', forbidden: ['قديم', 'تاريخ', 'تماثيل', 'زيارة'] },
    { target: 'قلعة حصينة', forbidden: ['بناء', 'قديم', 'تاريخ', 'حرب'] },
    { target: 'برج سياحي', forbidden: ['طويل', 'بناء', 'مدينة', 'منظر'] },
    { target: 'جسر معلق', forbidden: ['طريق', 'بحر', 'نهر', 'بناء'] },
    { target: 'نفق طويل', forbidden: ['تحت', 'أرض', 'جبل', 'طريق'] },
    { target: 'سد مائي', forbidden: ['ماء', 'نهر', 'بناء', 'كهرباء'] },
    { target: 'قناة ري', forbidden: ['ماء', 'زراعة', 'أرض', 'حقل'] },
    { target: 'مزرعة دواجن', forbidden: ['دجاج', 'بيض', 'أكل', 'حيوان'] },
    { target: 'بيت بلاستيك', forbidden: ['زراعة', 'نبات', 'خضار', 'شتاء'] },
    { target: 'معمل كيمياء', forbidden: ['بحث', 'علم', 'تجارب', 'أدوية'] },
    { target: 'مستشفى عام', forbidden: ['طبيب', 'مريض', 'علاج', 'ممرضة'] },
    { target: 'عيادة أسنان', forbidden: ['دكتور', 'فم', 'وجع', 'تنظيف'] },
    { target: 'صيدلية مناوبة', forbidden: ['دواء', 'دكتور', 'ليل', 'مريض'] },
];

const levenshtein = (a: string, b: string): number => {
    if (a.length === 0) return b.length;
    if (b.length === 0) return a.length;
    const matrix = [];
    for (let i = 0; i <= b.length; i++) matrix[i] = [i];
    for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
    for (let i = 1; i <= b.length; i++) {
        for (let j = 1; j <= a.length; j++) {
            if (b.charAt(i - 1) === a.charAt(j - 1)) {
                matrix[i][j] = matrix[i - 1][j - 1];
            } else {
                matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, Math.min(matrix[i][j - 1] + 1, matrix[i - 1][j] + 1));
            }
        }
    }
    return matrix[b.length][a.length];
};

export const ForbiddenWords: React.FC<ForbiddenWordsProps> = ({ onHome, isOBS }) => {
    const [config, setConfig] = useState<GameConfig>({
        joinKeyword: 'تحدي',
        maxPlayers: 100,
        roundDuration: 60,
        autoProgress: false,
        totalRounds: 10
    });

    const [phase, setPhase] = useState<GamePhase>('SETUP');
    const [participants, setParticipants] = useState<ChatUser[]>([]);
    const [scores, setScores] = useState<Record<string, number>>({});
    const [timer, setTimer] = useState(0);
    const [currentRound, setCurrentRound] = useState(1);
    const [currentChallenge, setCurrentChallenge] = useState<ForbiddenChallenge | null>(null);
    const [roundWinner, setRoundWinner] = useState<ChatUser | null>(null);
    const [hasShownWarning, setHasShownWarning] = useState(false);
    const hasShownWarningRef = useRef(false);

    // Inject custom CSS
    const customStyles = `
        @keyframes float-up {
            0% { transform: translateY(0px) scale(0.5); opacity: 0; }
            20% { opacity: 1; transform: translateY(-20px) scale(1.2); }
            100% { transform: translateY(-200px) scale(0.8); opacity: 0; }
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 40px rgba(239, 68, 68, 0.4); border-color: rgba(239, 68, 68, 0.8); }
            50% { box-shadow: 0 0 80px rgba(239, 68, 68, 0.8); border-color: rgba(255, 255, 255, 0.8); }
        }
        @keyframes drift {
             0% { background-position: 0% 50%; }
             50% { background-position: 100% 50%; }
             100% { background-position: 0% 50%; }
        }
        .celebration-particle {
            position: absolute;
            animation: float-up 3s ease-out forwards;
            opacity: 0;
        }
        .animate-drift {
            background-size: 200% 200%;
            animation: drift 10s ease infinite;
        }
    `;

    // Stats
    const [guessStats, setGuessStats] = useState<GuessStat[]>([]);
    const [closestGuess, setClosestGuess] = useState<{ user: string, word: string, distance: number } | null>(null);

    const phaseRef = useRef(phase);
    const configRef = useRef(config);
    const currentChallengeRef = useRef(currentChallenge);
    const participantsRef = useRef(participants);
    const channelRef = useRef<RealtimeChannel | null>(null);

    useEffect(() => {
        phaseRef.current = phase;
        configRef.current = config;
        currentChallengeRef.current = currentChallenge;
        participantsRef.current = participants;
    }, [phase, config, currentChallenge, participants]);

    const [suggestedChallenges, setSuggestedChallenges] = useState<ForbiddenChallenge[]>([]);

    // --- SYNC LOGIC ---
    useEffect(() => {
        const channel = supabase.channel('forbidden-words-game', {
            config: {
                broadcast: { self: false }
            }
        });
        channelRef.current = channel;

        if (isOBS) {
            channel.on('broadcast', { event: 'game_state' }, ({ payload }) => {
                const state = payload;
                if (state.phase) setPhase(state.phase);
                if (state.participants) setParticipants(state.participants);
                if (state.scores) setScores(state.scores);
                if (typeof state.timer === 'number') setTimer(state.timer);
                if (state.currentRound) setCurrentRound(state.currentRound);
                if (state.currentChallenge !== undefined) setCurrentChallenge(state.currentChallenge);
                if (state.roundWinner !== undefined) setRoundWinner(state.roundWinner);
                if (state.guessStats) setGuessStats(state.guessStats);
                if (state.closestGuess !== undefined) setClosestGuess(state.closestGuess);
                if (state.suggestedChallenges) setSuggestedChallenges(state.suggestedChallenges);
            }).subscribe();
        } else {
            channel.subscribe();
        }

        return () => {
            supabase.removeChannel(channel);
        };
    }, [isOBS]);

    // Broadcast state changes (Streamer Only)
    useEffect(() => {
        if (isOBS || !channelRef.current) return;

        // Throttle broadcasts if needed, but for local 1s timer it's fine
        channelRef.current.send({
            type: 'broadcast',
            event: 'game_state',
            payload: {
                phase,
                participants,
                scores,
                timer,
                currentRound,
                currentChallenge,
                roundWinner,
                guessStats,
                closestGuess,
                suggestedChallenges
            }
        });
    }, [phase, participants, scores, timer, currentRound, currentChallenge, roundWinner, guessStats, closestGuess, suggestedChallenges, isOBS]);


    const prepareNextChallenge = () => {
        const shuffled = [...CHALLENGES].sort(() => Math.random() - 0.5).slice(0, 3);
        setSuggestedChallenges(shuffled);
        if (!hasShownWarningRef.current) {
            setPhase('PRE_ROUND');
            setHasShownWarning(true);
            hasShownWarningRef.current = true;
        } else {
            setPhase('SELECT_WORD');
        }
    };

    const confirmSafeToSelect = () => {
        setPhase('SELECT_WORD');
    };

    const selectChallenge = (challenge: ForbiddenChallenge) => {
        setCurrentChallenge(challenge);
        setRoundWinner(null);
        setTimer(config.roundDuration);
        setGuessStats([]);
        setClosestGuess(null);
        setPhase('PLAYING');
    };

    const nextChallenge = () => {
        if (currentRound >= config.totalRounds) {
            setPhase('FINALE');
        } else {
            setCurrentRound(r => r + 1);
            prepareNextChallenge();
        }
    };

    useEffect(() => {
        const unsubscribe = chatService.onMessage((msg) => {
            const content = msg.content.trim().toLowerCase();
            const username = msg.user.username;

            if (phaseRef.current === 'LOBBY') {
                if (content === configRef.current.joinKeyword.toLowerCase()) {
                    setParticipants(prev => {
                        if (prev.length >= configRef.current.maxPlayers) return prev;
                        if (prev.some(p => p.username === username)) return prev;
                        chatService.fetchKickAvatar(username).then(avatar => {
                            if (avatar) {
                                setParticipants(current => current.map(p =>
                                    p.username === username ? { ...p, avatar } : p
                                ));
                            }
                        });
                        return [...prev, msg.user];
                    });
                }
            }

            // Only process game logic if NOT in OBS mode (Streamer is the source of truth)
            if (!isOBS && phaseRef.current === 'PLAYING' && currentChallengeRef.current) {
                if (!participantsRef.current.some(p => p.username === username)) return;

                const challenge = currentChallengeRef.current;

                // Track stats
                setGuessStats(prev => {
                    const existing = prev.find(g => g.word === content);
                    if (existing) {
                        return prev.map(g => g.word === content ? { ...g, count: g.count + 1, lastUser: username } : g).sort((a, b) => b.count - a.count);
                    }
                    return [...prev, { word: content, count: 1, lastUser: username }].sort((a, b) => b.count - a.count).slice(0, 20);
                });

                // Calculate distance
                const dist = levenshtein(content, challenge.target);
                setClosestGuess(prev => {
                    if (!prev || dist < prev.distance) {
                        return { user: username, word: content, distance: dist };
                    }
                    return prev;
                });

                // Check Forbidden
                if (challenge.forbidden.some(f => content.includes(f))) {
                    console.log(`Forbidden word used by ${username}!`);
                    return;
                }

                // Check Win
                if (content === challenge.target) {
                    handleWin(msg.user);
                }
            }
        });
        return () => unsubscribe();
    }, [isOBS]);

    const handleWin = (user: ChatUser) => {
        setRoundWinner(user);
        setScores(prev => ({ ...prev, [user.username]: (prev[user.username] || 0) + 1 }));
        setPhase('REVEAL');

        setTimeout(() => {
            if (currentRound >= config.totalRounds) {
                setPhase('FINALE');
                leaderboardService.recordWin(user.username, user.avatar || '', 250);
            } else {
                setCurrentRound(r => r + 1);
                prepareNextChallenge();
            }
        }, 5000);
    };

    useEffect(() => {
        let interval: number;
        // Timer only runs on Streamer side
        if (!isOBS && phase === 'PLAYING' && timer > 0) {
            interval = window.setInterval(() => {
                setTimer(prev => prev - 1);
            }, 1000);
        } else if (!isOBS && phase === 'PLAYING' && timer === 0) {
            setPhase('REVEAL');
            setTimeout(() => {
                if (currentRound >= config.totalRounds) {
                    setPhase('FINALE');
                } else {
                    setCurrentRound(r => r + 1);
                    prepareNextChallenge();
                }
            }, 5000);
        }
        return () => clearInterval(interval);
    }, [phase, timer, isOBS]);

    useEffect(() => {
        const handleKeyDown = (e: KeyboardEvent) => {
            if (phase === 'PRE_ROUND' && e.code === 'Space') {
                confirmSafeToSelect();
            }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
    }, [phase]);

    const startLobby = () => setPhase('LOBBY');
    const startRound = () => {
        setCurrentRound(1);
        setScores({});
        setHasShownWarning(false);
        prepareNextChallenge();
    };
    const resetGame = () => {
        setPhase('SETUP');
        setParticipants([]);
        setScores({});
        setCurrentRound(1);
        setHasShownWarning(false);
    };

    const copyOBSLink = () => {
        const url = `${window.location.origin}/?obs=true&view=FORBIDDEN_WORDS&transparent=true`;
        navigator.clipboard.writeText(url);
        alert('تم نسخ رابط OBS بنجاح!');
    };

    // --- OBS VIEW (REDESIGNED 1366x768) ---
    if (isOBS) {
        return (
            <div className="w-[1366px] h-[768px] flex flex-col p-6 bg-transparent text-right font-display select-none overflow-hidden" dir="rtl">
                <style>{customStyles}</style>
                {/* Background - Dark Red gradient for Forbidden Vibe */}
                <div className="absolute inset-0 bg-gradient-to-br from-black via-[#1a0505] to-[#2a0a0a] -z-10 animate-drift"></div>

                {/* Header - Always visible */}
                <div className="flex justify-between items-center mb-4 pl-2 pr-2">
                    <div className="flex items-center gap-4">
                        <div className="glass-card px-6 py-2 rounded-full bg-red-900/50 border border-red-500/30 flex items-center gap-3 shadow-lg backdrop-blur-md">
                            <Clock size={28} className="text-white" />
                            <span className={`text-4xl font-black font-mono ${timer < 10 && phase === 'PLAYING' ? 'text-red-500 animate-pulse' : 'text-white'}`}>
                                {phase === 'PLAYING' ? `${timer}s` : '--'}
                            </span>
                        </div>
                        <div className="glass-card px-5 py-2 rounded-full bg-white/5 border border-white/10 backdrop-blur-md">
                            <span className="text-xl font-black text-gray-300">الجولة {currentRound} / {config.totalRounds}</span>
                        </div>
                    </div>

                    <div className="glass-card px-6 py-2 rounded-full bg-red-500/10 border border-red-500/30 flex items-center gap-3 backdrop-blur-md">
                        <Users size={24} className="text-red-500" />
                        <span className="text-white font-black text-2xl">{participants.length}</span>
                    </div>
                </div>

                {/* WAITING PHASES (SETUP, LOBBY) */}
                {(phase === 'SETUP' || phase === 'LOBBY') && (
                    <div className="flex-1 flex flex-col items-center justify-center animate-in zoom-in duration-500">
                        {phase === 'SETUP' ? (
                            <>
                                <Loader2 size={80} className="text-red-500 animate-spin mb-6" />
                                <h1 className="text-6xl font-black text-white italic tracking-tighter mb-4 drop-shadow-xl">بانتظار البث...</h1>
                                <p className="text-2xl text-gray-400 font-bold bg-black/40 px-6 py-2 rounded-full border border-white/5">المذيع يقوم بإعداد اللعبة</p>
                            </>
                        ) : (
                            <>
                                <h1 className="text-6xl font-black text-white italic tracking-tighter mb-4 drop-shadow-[0_0_20px_rgba(220,38,38,0.5)]">قائمة الانتظار</h1>
                                <div className="flex items-center gap-4 px-10 py-3 bg-gradient-to-r from-red-600/20 to-orange-600/20 rounded-full border border-red-500/30 mb-8 backdrop-blur-sm">
                                    <span className="text-xl font-bold text-gray-200">أرسل الكلمة للانضمام:</span>
                                    <span className="text-5xl font-black text-red-500 drop-shadow-md">{config.joinKeyword}</span>
                                </div>

                                <div className="grid grid-cols-6 gap-4 w-full max-w-[1200px] px-6 max-h-[500px] overflow-y-auto custom-scrollbar p-4">
                                    {participants.map((p, i) => (
                                        <div key={p.username} className="glass-card p-3 rounded-2xl bg-white/5 border border-white/10 flex flex-col items-center gap-2 animate-in fade-in zoom-in hover:border-red-500/50 transition-colors">
                                            <div className="w-16 h-16 rounded-xl overflow-hidden bg-zinc-900 border-2 border-white/5">
                                                {p.avatar ? <img src={p.avatar} className="w-full h-full object-cover" /> : <User className="text-white/20 m-auto mt-3" />}
                                            </div>
                                            <span className="text-white font-bold truncate w-full text-center text-sm">{p.username}</span>
                                        </div>
                                    ))}
                                    {participants.length === 0 && <div className="col-span-full text-center text-white/20 text-xl py-20">بانتظار اللاعبين...</div>}
                                </div>
                            </>
                        )}
                    </div>
                )}

                {/* GAME PLAY PHASES */}
                {!['SETUP', 'LOBBY'].includes(phase) && (
                    <div className="flex-1 grid grid-cols-12 gap-6 pl-2 pr-2 pb-2 h-full overflow-hidden">
                        {/* LEFT: Stats & Cloud */}
                        <div className="col-span-3 flex flex-col gap-4 h-full">
                            <div className="glass-card flex-1 bg-black/40 border border-red-500/20 rounded-[2rem] p-5 relative overflow-hidden flex flex-col backdrop-blur-lg">
                                <div className="flex items-center gap-2 text-red-500 mb-4 font-black text-xl z-10 relative border-b border-red-500/10 pb-2">
                                    <Cloud size={24} /> الكلمات المتكررة
                                </div>
                                <div className="flex flex-wrap gap-2 relative z-10 content-start overflow-hidden">
                                    {guessStats.slice(0, 15).map((g, i) => (
                                        <div key={g.word} className="bg-white/5 border border-white/5 px-3 py-1 rounded-lg text-white font-bold transition-all"
                                            style={{ fontSize: `${Math.max(0.8, 1.5 - i * 0.1)}rem`, opacity: Math.max(0.4, 1 - i * 0.05) }}>
                                            {g.word}
                                        </div>
                                    ))}
                                    {guessStats.length === 0 && <div className="text-white/20 text-center w-full mt-10 text-lg font-bold">...</div>}
                                </div>
                            </div>

                            {/* Closest Guess */}
                            <div className="glass-card bg-zinc-900/80 border border-blue-500/20 rounded-[2rem] p-5 backdrop-blur-lg">
                                <div className="flex items-center gap-2 text-blue-400 mb-2 font-black text-xl">
                                    <Target size={24} /> أقرب محاولة
                                </div>
                                {closestGuess ? (
                                    <div className="flex flex-col gap-1">
                                        <span className="text-3xl text-white font-black truncate">{closestGuess.word}</span>
                                        <div className="flex items-center gap-2 mt-1">
                                            <div className="w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400"><User size={12} /></div>
                                            <span className="text-sm text-gray-300 font-bold">{closestGuess.user}</span>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="text-white/20 text-sm font-bold py-2">لا يوجد محاولات قريبة بعد</div>
                                )}
                            </div>
                        </div>

                        {/* CENTER: Game State */}
                        <div className="col-span-6 flex flex-col items-center justify-center relative px-2">
                            {(phase === 'PRE_ROUND' || phase === 'SELECT_WORD') && (
                                <div className="text-center animate-pulse">
                                    <Loader2 size={80} className="text-red-500 animate-spin mx-auto mb-6" />
                                    <h2 className="text-5xl font-black text-white mb-4">جاري اختيار التحدي...</h2>
                                    <p className="text-gray-400 font-bold text-2xl">استعدوا للمنافسة!</p>
                                </div>
                            )}

                            {(phase === 'PLAYING' || phase === 'REVEAL') && (
                                <div className="flex flex-col items-center gap-6 w-full h-full justify-center">
                                    <div className="text-center w-full">
                                        <h1 className="text-[5rem] font-black text-white italic drop-shadow-[0_4px_10px_rgba(0,0,0,0.5)] mb-6 leading-none tracking-tighter">خـــمّـــن!</h1>
                                    </div>
                                </div>
                            )}

                            {/* Winner Overlay - ENHANCED FOR OBS 1366x768 */}
                            {(phase === 'REVEAL' || phase === 'FINALE') && (
                                <div className="absolute inset-0 z-50 flex flex-col items-center justify-center bg-black/95 rounded-[2rem] animate-in zoom-in duration-300 border border-red-500/20 overflow-hidden shadow-2xl">
                                    {/* Celebration Particles */}
                                    <div className="absolute inset-0 pointer-events-none">
                                        {[...Array(25)].map((_, i) => (
                                            <div key={i} className="celebration-particle absolute w-6 h-6 rounded-full"
                                                style={{
                                                    left: `${Math.random() * 100}%`,
                                                    top: `${60 + Math.random() * 40}%`,
                                                    animationDelay: `${Math.random() * 2}s`,
                                                    backgroundColor: ['#ef4444', '#b91c1c', '#f87171', '#991b1b', '#f59e0b', '#fbbf24'][Math.floor(Math.random() * 6)],
                                                    boxShadow: '0 0 15px currentColor'
                                                }}></div>
                                        ))}
                                    </div>

                                    {roundWinner ? (
                                        <div className="flex flex-col items-center relative z-10 p-6">
                                            <div className="w-48 h-48 rounded-[3rem] border-4 border-red-500 overflow-hidden mb-4 shadow-[0_0_80px_rgba(239,68,68,0.6)] bg-zinc-800 relative group"
                                                style={{ animation: 'pulse-glow 2s infinite' }}>
                                                {roundWinner.avatar ? <img src={roundWinner.avatar} className="w-full h-full object-cover" /> : <User className="w-full h-full p-8 text-white/20" />}
                                                <div className="absolute inset-0 border-2 border-red-300 rounded-[3rem] animate-ping opacity-20"></div>
                                            </div>
                                            <h2 className="text-6xl font-black text-white mb-4 drop-shadow-2xl italic tracking-tighter bg-gradient-to-b from-white to-gray-300 bg-clip-text text-transparent">{roundWinner.username}</h2>
                                            <div className="bg-gradient-to-r from-red-600 to-red-800 px-12 py-4 rounded-[2rem] mt-2 shadow-[0_10px_40px_rgba(220,38,38,0.4)] border border-red-400/30 transform hover:scale-105 transition-transform">
                                                <span className="text-5xl text-white font-black drop-shadow-md">{currentChallenge?.target}</span>
                                            </div>
                                            <div className="mt-8 text-amber-400 font-bold text-2xl animate-bounce drop-shadow-[0_2px_5px_rgba(0,0,0,0.8)] tracking-widest uppercase">
                                                🎉 New Winner 🎉
                                            </div>
                                        </div>
                                    ) : (
                                        <h2 className="text-8xl text-white font-black italic text-center drop-shadow-[0_4px_10px_rgba(255,255,255,0.2)]">انتهى الوقت!</h2>
                                    )}
                                </div>
                            )}
                        </div>

                        {/* RIGHT: Leaderboard */}
                        <div className="col-span-3">
                            <div className="glass-card bg-black/40 border border-white/10 rounded-[2rem] p-5 h-full flex flex-col backdrop-blur-lg">
                                <div className="flex items-center gap-3 mb-4 pb-4 border-b border-white/10">
                                    {(phase === 'PRE_ROUND' || phase === 'SELECT_WORD') ? (
                                        <>
                                            <Users size={24} className="text-red-500" />
                                            <span className="text-2xl font-black text-white">اللاعبين ({participants.length})</span>
                                        </>
                                    ) : (
                                        <>
                                            <Trophy className="text-yellow-500" size={24} />
                                            <span className="text-2xl font-black text-white">المتصدرين</span>
                                        </>
                                    )}
                                </div>
                                <div className="space-y-3 flex-1 overflow-y-auto custom-scrollbar">
                                    {(phase === 'PRE_ROUND' || phase === 'SELECT_WORD') ? (
                                        participants.map((p, i) => (
                                            <div key={p.username} className="flex items-center gap-3 bg-white/5 rounded-xl p-3 border border-white/5 hover:bg-white/10 transition-colors">
                                                <div className="w-10 h-10 rounded-lg overflow-hidden bg-zinc-800 shrink-0 border border-white/10">
                                                    {p.avatar ? <img src={p.avatar} className="w-full h-full object-cover" /> : <User className="text-white/20 m-auto mt-2 h-6 w-6" />}
                                                </div>
                                                <span className="text-lg font-bold text-white truncate">{p.username}</span>
                                            </div>
                                        ))
                                    ) : (
                                        Object.entries(scores).sort((a: any, b: any) => Number(b[1]) - Number(a[1])).slice(0, 8).map(([username, score], i) => (
                                            <div key={username} className="flex items-center gap-3 group">
                                                <div className={`w-8 h-8 flex items-center justify-center rounded-lg font-black text-lg ${i === 0 ? 'bg-yellow-500 text-black shadow-[0_0_15px_rgba(234,179,8,0.5)]' : i === 1 ? 'bg-gray-300 text-black' : i === 2 ? 'bg-orange-700 text-white' : 'bg-white/10 text-white/50'}`}>
                                                    {i + 1}
                                                </div>
                                                <div className="flex-1 bg-white/5 group-hover:bg-white/10 rounded-xl p-3 flex justify-between items-center border border-white/5 transition-colors">
                                                    <span className="text-base font-bold text-white truncate max-w-[100px]">{username}</span>
                                                    <span className="text-lg text-red-500 font-black">{score}</span>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                    {(phase === 'PRE_ROUND' || phase === 'SELECT_WORD') && participants.length === 0 && (
                                        <div className="text-white/20 text-center mt-10 text-sm">لا يوجد لاعبين</div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                )}
            </div>
        );
    }

    // --- STREAMER VIEW ---
    return (
        <div className="w-full h-full relative flex flex-col items-center bg-transparent text-right font-display select-none overflow-hidden" dir="rtl">
            <div className="absolute inset-0 bg-[#0a0a0c] -z-10">
                <div className="absolute top-0 right-0 w-[800px] h-[800px] bg-gradient-to-br from-amber-600/10 via-orange-600/5 to-transparent blur-[150px] rounded-full"></div>
                <div className="absolute bottom-0 left-0 w-[600px] h-[600px] bg-gradient-to-tr from-zinc-700/10 via-zinc-900/5 to-transparent blur-[120px] rounded-full"></div>
                <div className="absolute inset-0 opacity-[0.03] bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:40px_40px]"></div>
            </div>

            {/* PRE-ROUND "CLOSE SCREEN" WARNING */}
            {phase === 'PRE_ROUND' && (
                <div className="w-full h-full flex flex-col items-center justify-center overflow-hidden z-50 animate-in fade-in duration-300">
                    <div className="absolute inset-0 bg-[repeating-linear-gradient(45deg,transparent,transparent_20px,#222_20px,#222_40px)] opacity-20 pointer-events-none"></div>

                    <div className="relative z-10 flex flex-col items-center animate-in zoom-in duration-300">
                        <div className="w-32 h-32 bg-red-600 rounded-3xl flex items-center justify-center mb-8 rotate-3 shadow-[0_0_50px_rgba(220,38,38,0.5)] animate-pulse">
                            <EyeOff size={64} className="text-white" />
                        </div>
                        <h1 className="text-6xl font-black text-white mb-4 uppercase tracking-tighter">أغـلـق الشـاشـة الآن!</h1>
                        <p className="text-2xl text-gray-400 font-bold mb-4">الرجاء إخفاء الشاشة لاختيار الكلمة السرية</p>
                        <p className="text-xl text-red-500 font-black bg-red-500/10 px-6 py-2 rounded-xl border border-red-500/30 mb-8 animate-pulse">
                            تنبيه: يجب أن يكون عرض OBS: 1366 و الارتفاع: 768
                        </p>

                        <div className="flex gap-4">
                            <div className="glass-card px-8 py-4 bg-zinc-900 border border-white/10 rounded-2xl">
                                <span className="text-gray-500 font-bold text-sm block mb-1">الحالة في OBS</span>
                                <span className="text-green-500 font-black text-xl flex items-center gap-2"><CheckCircle2 size={18} /> انتظار (آمن)...</span>
                            </div>
                            <div className="glass-card px-8 py-4 bg-zinc-900 border border-white/10 rounded-2xl">
                                <span className="text-gray-500 font-bold text-sm block mb-1">الحالة لديك</span>
                                <span className="text-red-500 font-black text-xl flex items-center gap-2"><EyeOff size={18} /> خاص - مخفي</span>
                            </div>
                        </div>

                        <button
                            onClick={confirmSafeToSelect}
                            className="mt-16 px-16 py-6 bg-white hover:bg-gray-200 text-black font-black text-2xl rounded-full shadow-2xl transition-all hover:scale-105 flex items-center gap-3 cursor-pointer z-50"
                        >
                            <Monitor size={24} /> فـتـح الـخـيـارات (Space)
                        </button>

                        <button
                            onClick={copyOBSLink}
                            className="mt-6 px-8 py-3 bg-white/10 hover:bg-white/20 text-white font-bold rounded-full border border-white/10 flex items-center gap-2 transition-all"
                        >
                            <Copy size={20} /> نسخ رابط OBS
                        </button>
                    </div>
                </div>
            )}

            {phase === 'SETUP' && (
                <div className="w-full max-w-4xl mt-12 animate-in fade-in zoom-in duration-700">
                    <div className="text-center mb-12">
                        <ShieldOff size={80} className="mx-auto text-amber-500 mb-6 drop-shadow-[0_0_30px_rgba(245,158,11,0.5)]" />
                        <h1 className="text-7xl font-black text-white italic tracking-tighter uppercase font-serif">الـمـمـنـوع مـرغـوب</h1>
                        <p className="text-amber-500 font-black tracking-[0.4em] text-xs uppercase mt-3">Elite Forbidden Word Challenge</p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div className="glass-card p-10 rounded-[3.5rem] border border-white/10 bg-white/5 backdrop-blur-3xl space-y-8">
                            <h3 className="text-2xl font-black text-white flex items-center gap-3">
                                <Settings className="text-amber-400" /> إعـدادات الـلـعـبـة
                            </h3>

                            <div className="space-y-6">
                                <div className="space-y-3">
                                    <label className="text-xs font-bold text-gray-400 uppercase">كلمة الانضمام</label>
                                    <input
                                        value={config.joinKeyword}
                                        onChange={e => setConfig({ ...config, joinKeyword: e.target.value })}
                                        className="w-full bg-black/50 border-2 border-white/10 focus:border-amber-400 rounded-3xl p-5 text-white font-bold outline-none transition-all shadow-inner"
                                    />
                                </div>
                                <div className="space-y-3">
                                    <div className="flex justify-between items-center">
                                        <label className="text-xs font-bold text-gray-400 uppercase">عـدد الـجـولات</label>
                                        <span className="text-3xl font-black font-mono text-white">{config.totalRounds}</span>
                                    </div>
                                    <input
                                        type="range" min="5" max="500" step="5"
                                        value={config.totalRounds}
                                        onChange={e => setConfig({ ...config, totalRounds: +e.target.value })}
                                        className="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-amber-500"
                                    />
                                </div>
                            </div>
                        </div>

                        <div className="flex flex-col gap-6">
                            <div className="glass-card p-10 rounded-[3.5rem] border border-white/10 bg-white/5 backdrop-blur-3xl flex-1 flex flex-col justify-center items-center text-center">
                                <AlertTriangle size={54} className="text-red-500 mb-4 animate-pulse" />
                                <h4 className="text-2xl font-black text-white mb-2">تـحـذير: احـذر الـحظـر!</h4>
                                <p className="text-gray-400 text-sm font-bold leading-relaxed px-6">
                                    حاول تخمين الكلمة الهدف، لكن حذاري! استخدام أي كلمة من قائمة <span className="text-red-500 underline">الكلمات الممنوعة</span> سيتجاهل إجابتك تماماً.
                                </p>
                                <button
                                    onClick={copyOBSLink}
                                    className="mt-6 px-5 py-2 bg-zinc-800 hover:bg-zinc-700 hover:border-amber-500 text-white text-xs font-bold rounded-full border border-white/10 flex items-center gap-2 transition-all group"
                                >
                                    <Monitor size={14} className="group-hover:text-amber-400" /> نسخ رابط OBS
                                </button>
                            </div>

                            <button
                                onClick={startLobby}
                                className="w-full bg-gradient-to-r from-amber-600 to-orange-700 hover:scale-[1.02] text-white font-black py-8 rounded-[3rem] text-4xl shadow-[0_20px_50px_rgba(245,158,11,0.3)] transition-all flex items-center justify-center gap-4 group"
                            >
                                دُخـول الـتـحدي <Zap className="group-hover:rotate-12 transition-transform" />
                            </button>
                        </div>
                    </div>

                    <button onClick={onHome} className="mt-8 mx-auto flex items-center gap-2 text-gray-500 hover:text-white font-bold transition-all">
                        <ChevronLeft /> العودة للرئيسية
                    </button>
                </div>
            )}

            {phase === 'LOBBY' && (
                <div className="w-full max-w-6xl mt-12 animate-in fade-in duration-700 flex flex-col items-center">
                    <div className="text-center mb-12">
                        <h1 className="text-8xl font-black text-white italic tracking-tighter mb-4 red-neon-text">اخـتـبار الـذكـاء</h1>
                        <div className="flex items-center justify-center gap-4 bg-white/5 px-12 py-6 rounded-[3rem] border border-white/10 backdrop-blur-md shadow-2xl">
                            <span className="text-2xl font-bold text-gray-300">أرسل الكلمة لـحل التحدي:</span>
                            <span className="text-5xl font-black text-amber-500 px-8 py-2 bg-amber-500/10 rounded-2xl border border-amber-500/30 font-serif">{config.joinKeyword}</span>
                        </div>
                    </div>

                    <div className="w-full grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6 px-10 mb-20 overflow-y-auto max-h-[500px] custom-scrollbar">
                        {participants.map((p, i) => (
                            <div key={p.username} className="glass-card p-6 rounded-[3rem] border border-white/5 flex flex-col items-center gap-4 animate-in zoom-in group hover:border-amber-500/30 transition-all bg-white/5" style={{ animationDelay: `${(i as number) * 30}ms` }}>
                                <div className="w-24 h-24 rounded-[2.5rem] overflow-hidden border-4 border-white/10 shadow-xl group-hover:scale-110 transition-transform bg-zinc-900 flex items-center justify-center">
                                    {p.avatar ? (
                                        <img src={p.avatar} className="w-full h-full object-cover" alt="" />
                                    ) : (
                                        <User className="text-white/20" size={48} />
                                    )}
                                </div>
                                <span className="font-black text-white text-base truncate w-full text-center">{p.username}</span>
                            </div>
                        ))}
                    </div>

                    <div className="fixed bottom-12 left-0 right-0 flex justify-center gap-8 z-50">
                        <button onClick={resetGame} className="px-10 py-6 bg-white/5 hover:bg-white/10 rounded-[2.5rem] text-gray-400 font-black border border-white/10 transition-all flex items-center gap-3">
                            <Trash2 size={24} /> إلـغـاء
                        </button>
                        <button
                            onClick={startRound}
                            className="px-24 py-6 bg-gradient-to-r from-amber-600 to-orange-600 border-b-8 border-orange-800 hover:border-b-4 hover:translate-y-1 rounded-[2.5rem] text-white font-black text-3xl shadow-[0_20px_40px_rgba(245,158,11,0.3)] transition-all flex items-center gap-4"
                        >
                            <Play size={32} /> بـدء الـمـنـافـسـة ({participants.length})
                        </button>
                        <button
                            onClick={copyOBSLink}
                            className="w-20 h-20 rounded-[2rem] bg-zinc-800 hover:bg-zinc-700 border border-white/10 flex items-center justify-center text-white transition-all shadow-xl hover:scale-105 group"
                            title="نسخ رابط OBS"
                        >
                            <Copy size={32} className="group-hover:text-amber-500 transition-colors" />
                        </button>
                    </div>
                </div>
            )}

            {phase === 'SELECT_WORD' && (
                <div className="w-full h-full flex flex-col items-center justify-center p-10 animate-in zoom-in duration-500">
                    <h2 className="text-6xl font-black text-white mb-16 italic tracking-tighter">اخـتـر الـتـحدي الـقادم</h2>
                    <div className="flex gap-10">
                        {suggestedChallenges.map((c, i) => (
                            <button
                                key={i}
                                onClick={() => selectChallenge(c)}
                                className="px-16 py-12 bg-white/5 hover:bg-amber-600 rounded-[4rem] border-2 border-white/10 hover:border-white text-5xl font-black text-white transition-all hover:scale-110 shadow-2xl flex flex-col items-center gap-4"
                            >
                                <span>{c.target}</span>
                                <span className="text-xs text-white/50">{c.forbidden.join(' - ')}</span>
                            </button>
                        ))}
                    </div>

                    <button
                        onClick={copyOBSLink}
                        className="absolute top-10 right-10 flex items-center gap-2 px-6 py-3 bg-white/5 hover:bg-white/10 rounded-full border border-white/10 text-white font-bold transition-all hover:scale-105"
                    >
                        <Copy size={20} /> نسخ رابط OBS
                    </button>
                </div>
            )}

            {(phase === 'PLAYING' || phase === 'REVEAL') && currentChallenge && (
                <div className="w-full h-full flex flex-col items-center justify-center p-8 relative">
                    {/* Header Overlay */}
                    <div className="absolute top-10 left-10 right-10 flex justify-between items-start">
                        <div className="flex flex-col gap-4">
                            <div className="glass-card px-10 py-5 rounded-[2.5rem] border border-white/10 flex items-center gap-6 bg-black/60 backdrop-blur-xl">
                                <div className="text-right">
                                    <div className="text-[10px] font-black text-amber-500 uppercase tracking-widest">الـجـولـة</div>
                                    <div className="text-5xl font-black text-white font-mono">{currentRound} / {config.totalRounds}</div>
                                </div>
                                <Target size={40} className="text-amber-500" />
                            </div>
                            <div className="glass-card px-10 py-5 rounded-[2.5rem] border border-white/10 flex items-center gap-6 bg-black/60 backdrop-blur-xl">
                                <div className="text-right">
                                    <div className="text-[10px] font-black text-red-500 uppercase tracking-widest">الـمـؤقـت</div>
                                    <div className={`text-4xl font-black font-mono ${timer < 5 ? 'text-red-500 animate-pulse' : 'text-white'}`}>{timer}s</div>
                                </div>
                                <Clock size={32} className={timer < 5 ? 'text-red-500' : 'text-gray-500'} />
                            </div>
                        </div>

                        <div className="glass-card w-80 rounded-[3rem] border border-white/10 bg-black/60 backdrop-blur-xl overflow-hidden shadow-2xl">
                            <div className="p-6 border-b border-white/10 flex justify-between items-center bg-white/5">
                                <h3 className="font-black text-white italic">قـائـمـة الـشـرف</h3>
                                <Trophy size={18} className="text-yellow-500" />
                            </div>
                            <div className="p-5 space-y-3 max-h-[400px] overflow-y-auto custom-scrollbar">
                                {Object.entries(scores).sort((a: any, b: any) => Number(b[1]) - Number(a[1])).slice(0, 5).map(([user, score], i) => (
                                    <div key={user} className="flex items-center gap-4 bg-white/5 p-4 rounded-3xl border border-white/5">
                                        <div className="w-10 h-10 rounded-xl bg-amber-600 text-white font-black flex items-center justify-center">#{i + 1}</div>
                                        <div className="flex-1">
                                            <div className="text-sm font-black text-white">{user}</div>
                                            <div className="text-xs text-amber-500 font-bold">{score} تـخـمينات</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="flex flex-col items-center gap-10 mt-20">
                        <div className="text-center">
                            <h2 className="text-8xl font-black text-white italic tracking-tighter mb-4 drop-shadow-[0_0_40px_rgba(255,255,255,0.2)]">خـمّـن الـكـلـمـة!</h2>
                            <div className="flex items-center justify-center gap-3 opacity-30">
                                <div className="h-px w-20 bg-white"></div>
                                <Brain size={24} className="text-white" />
                                <div className="h-px w-20 bg-white"></div>
                            </div>
                        </div>

                        <div className="glass-card p-12 rounded-[5rem] border-8 border-red-500/20 bg-black/40 backdrop-blur-3xl shadow-[0_0_100px_rgba(239,68,68,0.1)] relative">
                            <div className="absolute -top-6 left-1/2 -translate-x-1/2 bg-red-600 text-white font-black px-10 py-2 rounded-full text-xl shadow-xl uppercase tracking-widest border-2 border-white">
                                الـمـمـنـوعـات
                            </div>
                            <div className="flex flex-wrap justify-center gap-6 mt-4">
                                {currentChallenge.forbidden.map((f, i) => (
                                    <div key={i} className="px-10 py-6 bg-red-500/10 border-2 border-red-500/30 rounded-[2.5rem] flex flex-col items-center gap-2 group hover:border-red-600 transition-all transform hover:scale-105">
                                        <span className="text-5xl font-black text-white italic">{f}</span>
                                        <div className="flex gap-2">
                                            <ShieldOff size={16} className="text-red-500" />
                                            <span className="text-[10px] font-black text-gray-500 uppercase tracking-widest">Forbidden</span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {phase === 'PLAYING' ? (
                            <div className="flex items-center gap-6 animate-pulse">
                                <MessageSquare size={32} className="text-amber-500" />
                                <span className="text-3xl font-black text-gray-400 italic">بـانـتـظـار الإجـابـة الأولـى الـصـحـيـحـة...</span>
                            </div>
                        ) : (
                            <div className="animate-in slide-in-from-bottom duration-500">
                                {roundWinner ? (
                                    <div className="flex flex-col items-center gap-8 bg-amber-500/10 p-10 rounded-[4rem] border-4 border-amber-500/30 backdrop-blur-2xl">
                                        <div className="flex items-center gap-8">
                                            <div className="w-32 h-32 rounded-[3rem] overflow-hidden border-4 border-amber-500 shadow-2xl bg-zinc-900 flex items-center justify-center">
                                                {roundWinner.avatar ? (
                                                    <img src={roundWinner.avatar} className="w-full h-full object-cover" alt="" />
                                                ) : (
                                                    <User className="text-white/20" size={64} />
                                                )}
                                            </div>
                                            <div className="text-right">
                                                <div className="text-6xl font-black text-white mb-2 italic tracking-tighter">{roundWinner.username}</div>
                                                <div className="text-3xl font-bold text-gray-400">عرف الكلمة: <span className="text-amber-500 text-6xl mr-6">{currentChallenge.target}</span></div>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="text-center bg-zinc-900/80 p-12 rounded-[4rem] border-4 border-white/5">
                                        <h2 className="text-6xl font-black text-white/30 italic mb-4 uppercase">نـفذ الـوقـت!</h2>
                                        <div className="text-3xl font-bold text-gray-500">الـكلمة الـهـدف: <span className="text-white text-6xl mr-6">{currentChallenge.target}</span></div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            )}

            {phase === 'FINALE' && (
                <div className="w-full h-full flex flex-col items-center justify-center p-10 animate-in fade-in duration-1000">
                    <div className="mb-12 relative scale-125">
                        <div className="absolute inset-0 bg-amber-500 blur-[150px] opacity-25 rounded-full"></div>
                        <Brain size={150} className="text-amber-500 animate-pulse relative z-10" />
                    </div>

                    <h1 className="text-9xl font-black text-white italic tracking-tighter mb-8 drop-shadow-[0_20px_60px_rgba(245,158,11,0.2)]">عـبـقـري الـكلمـات</h1>

                    {(() => {
                        const sortedScores = Object.entries(scores).sort((a, b) => Number(b[1]) - Number(a[1]));
                        const topPlayer = sortedScores[0];
                        if (!topPlayer) return null;

                        return (
                            <div className="flex flex-col items-center gap-8 mb-20 animate-in zoom-in duration-700 delay-300">
                                <div className="w-80 h-80 rounded-[5rem] overflow-hidden border-8 border-amber-500 shadow-[0_0_120px_rgba(245,158,11,0.4)] relative bg-zinc-900 flex items-center justify-center">
                                    {participants.find(p => p.username === topPlayer[0])?.avatar ? (
                                        <img src={participants.find(p => p.username === topPlayer[0])?.avatar} className="w-full h-full object-cover" alt="" />
                                    ) : (
                                        <User className="text-white/20" size={120} />
                                    )}
                                </div>
                                <div className="text-center">
                                    <div className="text-8xl font-black text-white mb-6 italic tracking-tighter">{topPlayer[0]}</div>
                                    <div className="text-4xl px-20 py-5 bg-amber-500 text-black font-black rounded-[2.5rem] shadow-2xl italic tracking-widest uppercase">
                                        TOTAL SCORE: {topPlayer[1]} POINTS
                                    </div>
                                </div>
                            </div>
                        );
                    })()}

                    <div className="flex gap-8">
                        <button onClick={onHome} className="px-16 py-6 bg-white/5 hover:bg-white/10 text-white font-black rounded-[2.5rem] border border-white/10 transition-all text-2xl">
                            الـرئـيـسـيـة
                        </button>
                        <button onClick={resetGame} className="px-24 py-6 bg-amber-500 hover:bg-amber-600 text-black font-black rounded-[2.5rem] transition-all text-3xl shadow-[0_20px_50px_rgba(245,158,11,0.3)] hover:scale-105">
                            تـحدي جـديـد
                        </button>
                    </div>
                </div>
            )}
        </div>
    );
};
